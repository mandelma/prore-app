import{aX as oe,k as ce,a as se,Y as ae,aY as X,r as u,_ as W,C as ne,D as ie,aZ as ye,c as y,o as i,g as t,b as d,w as f,h as g,e as s,l as re,T as ge,y as c,a_ as ke,n as be,m as A,z as V,i as z,F as Oe,Q as q,v as Ce,a5 as Z,I as _,H as Ve,aU as Pe,P as we,J as $e,f as Be,O as je,aD as De,A as J,a$ as ee,K as Ae,b0 as te}from"./index-B6-cChpL.js";import{l as ze}from"./loadGoogleMap-DZ-zVA3K.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-93e-Jyro.js";const Te={style:{padding:"13px 0 20px 0"}},he={key:0},Ie={key:1,style:{"border-top":"1px solid grey"}},Ee={style:{display:"flex","justify-content":"right"}},Le={key:0,style:{"margin-bottom":"20px"}},Re={key:0},xe={class:"card card-body"},Ne={class:"mt-3"},Ue={style:{padding:"13px","font-size":"14px","margin-bottom":"20px"}},Me={style:{display:"flex","justify-content":"right","margin-bottom":"13px"}},He={style:{"text-align":"left","margin-bottom":"10px"}},Fe={key:1,style:{"margin-bottom":"20px"}},Se={key:1,style:{padding:"13px","margin-top":"13px",border:"1px solid blue"}},qe={style:{display:"flex","justify-content":"right","margin-bottom":"7px"}},Ge=Object.assign({name:"client-offer"},{__name:"ClientOffer",props:{client:{type:Object,default:()=>({})},open:{type:Boolean,default:!1}},setup(M){const x=M,{client:v,open:de}=oe(x),H=ce(),N=se();ae();const b=X("resizeParent"),L=X("unlockParent");function $(){typeof b=="function"&&b()}function G(){typeof L=="function"&&L()}const T=ye,B=u(null),h=u(null),I=u(!1),{user:p}=W(H),{providerId:F,provider:j}=W(N),k=u(null),P=u("here"),U=u(""),O=u(""),D=u(!1),w=u(!1);u(null),ne(()=>x.client?.professional?.[0]?.profession||""),ie(async()=>{await E(),console.log("CXC "+await T.findDistance([j.value.latitude,j.value.longitude],[v.value.latitude,v.value.longitude]));const a=await T.findDistance([j.value.latitude,j.value.longitude],[v.value.latitude,v.value.longitude]);a&&(console.log("Distance is "+a.distance),console.log("Duration is "+a.duration),B.value=a.distance,h.value=a.duration)});const E=async()=>{try{await ze(),console.log("Map is inited in ClientOffer! ✅")}catch(a){console.error("Google Maps failed to load ❌",a),w.value=!0}},S=()=>{console.log("Make offer!"),I.value=!0},Q=()=>{console.log("Creating offer! "+k.value);const a={bookingID:v.value.id,sender:p.value.id,isNewOffer:!0,name:j.value.pName,placeOrGo:P.value,area:v.value.zone,distance:B?.value,duration:h?.value,price:k.value,description:U.value,place:P.value,provider:F.value},e=v.value.user.id;console.log("Addressee - "+e),N.addProviderOffer(v.value.id,e,a)},R=()=>{console.log("Quit offer")},K=()=>{console.log("Reject / poista"),confirm("Oletko varmaa, että haluat poistaa tilauksen!?")===!0?(D.value=!0,console.log("Reject"),N.removeBookingOffer(v.value.id)):console.log("You canceled!")};return(a,e)=>(i(),y("div",null,[t("div",Te,[d(s(re),{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=r=>w.value=r),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:f(()=>[...e[12]||(e[12]=[g("VIRHE LOMAKEELLA! ",-1)])]),small:f(()=>[...e[13]||(e[13]=[])]),default:f(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[0]||(e[0]=(...r)=>a.hideError&&a.hideError(...r))}),e[14]||(e[14]=g(" ⚠️ We couldn’t load Google Maps right now. Please check your network connection and try again later. ",-1))]),_:1},8,["modelValue"])]),!s(v).professional&&!a.road?(i(),y("div",he,[d(s(ge),{color:"info"})])):(i(),y("div",Ie,[d(s(ke),{borderless:"",style:{"font-size":"12px",color:"#dddddd","text-align":"left"}},{default:f(()=>[t("tbody",null,[t("tr",null,[e[15]||(e[15]=t("td",null," Osoite: ",-1)),t("td",null,c(s(v).address),1)]),t("tr",null,[e[16]||(e[16]=t("td",null," Tarvitaan ammattilaista: ",-1)),t("td",null,c(s(v)?.professional?.[0]),1)]),t("tr",null,[e[17]||(e[17]=t("td",null," Ajankohda: ",-1)),t("td",null,c(s(v).date),1)]),t("tr",null,[e[18]||(e[18]=t("td",null," Tehtävän kuvaus: ",-1)),t("td",null,c(s(v).description),1)]),e[21]||(e[21]=t("tr",null,[t("td",null," Kuvat tehtävästä: "),t("td")],-1)),t("tr",null,[e[19]||(e[19]=t("td",null," Etäisyys ",-1)),t("td",null,c(B.value),1)]),t("tr",null,[e[20]||(e[20]=t("td",null," Matkan aikaa: ",-1)),t("td",null,c(h.value),1)]),e[22]||(e[22]=t("tr",null,[t("td"),t("td")],-1))])]),_:1}),t("div",Ee,[d(s(A),{color:"primary",class:"mb-3"},{default:f(()=>[d(s(be),{size:"2x"},{default:f(()=>[...e[23]||(e[23]=[t("i",{class:"far fa-comment"},null,-1)])]),_:1})]),_:1})]),s(v).isIncludeOffers?(i(),y("div",Le,[s(v).offers.some(r=>r.bookingID===s(v).id)?V("",!0):(i(),y("div",Re,[d(s(A),{disabled:a.isDisableProNotOfferBtns,class:"mb-3",block:"",color:"primary",size:"lg",onClick:e[2]||(e[2]=r=>S(a.booking))},{default:f(()=>[...e[24]||(e[24]=[g(" Tee Hintatarjous ",-1)])]),_:1},8,["disabled"]),d(Pe,{name:"fade-slide",onBeforeEnter:$,onEnter:$,onAfterEnter:G,onBeforeLeave:$,onLeave:$,onAfterLeave:G},{default:f(()=>[Oe(t("div",xe,[t("div",Ne,[t("div",Ue,[t("div",Me,[d(s(q),{white:"",onClick:e[3]||(e[3]=r=>I.value=!1)})]),t("form",null,[d(s(Ce),{type:"number",label:"Tarjoa hintasi",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=r=>k.value=r),wrapperClass:"mb-4"},null,8,["modelValue"]),t("div",He,[d(s(Z),{label:"Tarjoan palvelu asiakkaan luona",name:"area",modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=r=>P.value=r),value:"go"},null,8,["modelValue"]),d(s(Z),{label:"Tarjoan palvelua paikalla",name:"area",modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=r=>P.value=r),value:"here"},null,8,["modelValue"])]),d(s(_),{style:{},label:"Anna tarvittaessa lisäselvityksiä...",rows:"3",modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=r=>U.value=r)},null,8,["modelValue"]),k.value?(i(),z(s(A),{key:0,disabled:a.isDisableProNotOfferBtns,label:"Anna hintatarjous",block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:Q},{default:f(()=>[...e[25]||(e[25]=[g(" Lähetä ",-1)])]),_:1},8,["disabled"])):V("",!0)])])])],512),[[Ve,I.value]])]),_:1}),I.value?V("",!0):(i(),z(s(A),{key:0,disabled:a.isDisableProNotOfferBtns,block:"",outline:"danger",onClick:K,size:"lg"},{default:f(()=>[...e[26]||(e[26]=[g("Poista tilaus",-1)])]),_:1},8,["disabled"]))]))])):(i(),y("div",Fe,[D.value?V("",!0):(i(),z(s(A),{key:0,disabled:a.isDisableProNotMapBtns,block:"",outline:"success",size:"lg",onClick:e[8]||(e[8]=r=>a.confirmBooking(a.booking))},{default:f(()=>[...e[27]||(e[27]=[g(" Varmista tilaus ",-1)])]),_:1},8,["disabled"])),D.value?(i(),y("div",Se,[t("div",qe,[d(s(q),{white:"",onClick:e[9]||(e[9]=r=>D.value=!1)})]),d(s(_),{style:{},label:"Anna syy...",rows:"3",modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=r=>O.value=r)},null,8,["modelValue"]),O.value.length>1?(i(),z(s(A),{key:0,disabled:a.isDisableProNotMapBtns,block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:e[11]||(e[11]=r=>a.confirmRejectBookingNoOffers(a.booking))},{default:f(()=>[...e[28]||(e[28]=[g(" Varmista ",-1)])]),_:1},8,["disabled"])):V("",!0)])):V("",!0),D.value?V("",!0):(i(),z(s(A),{key:2,block:"",outline:"danger",size:"lg",onClick:R},{default:f(()=>[...e[29]||(e[29]=[g(" Poista tilaus ",-1)])]),_:1}))]))]))]))}}),le=ue(Ge,[["__scopeId","data-v-ccd93a70"]]),Qe={style:{"padding-top":"17px"}},Ke={style:{float:"right",padding:"10px"}},Ye={key:0},Je={class:"line"},We={class:"left-item"},Xe={key:0,class:"right-item"},Ze=["onClick"],_e={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},et={key:1,class:"booking-row-seen"},tt={class:"line"},lt={class:"left-item"},ot={key:0,class:"right-item"},st=["onClick"],at={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},nt={key:1},it=Object.assign({name:"client-offers-list"},{__name:"ClientOffersList",props:{isPro:{type:Boolean},provider:{type:Object},offersIn:{type:Array,default:()=>[]},credit:{type:Number}},setup(M){ae();const x=M,{offersIn:v,isPro:de,credit:H}=oe(x),N=Be(),b=u(23),L=se(),{incomingOffers:$,providerId:G}=W(L),T=u({}),B=u(!1),h=u(!1),I=u(!1),p=u(!1),F=u(!1),j=u(null),k=u(0),P=u(0),U=ne(()=>Array.isArray($.value)?$.value:[]),O=u(null);function D(n){O.value=n?.$el??n??null}let w=0,E=0;function S(){const n=O.value;!p.value||!n||(w&&cancelAnimationFrame(w),E&&cancelAnimationFrame(E),w=requestAnimationFrame(()=>{E=requestAnimationFrame(()=>{const l=O.value;!l||!p.value||(l.style.height=l.scrollHeight+"px")})}))}function Q(){w&&cancelAnimationFrame(w),E&&cancelAnimationFrame(E),O.value&&requestAnimationFrame(()=>{const l=O.value;l&&(l.style.height="")})}te("resizeParent",S),te("unlockParent",Q);let R;ie(()=>{"ResizeObserver"in window&&(R=new ResizeObserver(()=>S()),O.value&&R.observe(O.value))}),we(()=>{R&&R.disconnect()});function K(n){const[l,o]=n.split(", "),[C,m,ve]=l.split("/").map(Number),[pe,me]=o.split(":").map(Number);return new Date(ve,m-1,C,pe,me)}const a=async(n,l)=>{await Ae.addVisitor(n,l),console.log("VISITOR id is "+l.visitor),L.addVisitorForBooking(n,l)},e=async(n,l)=>{if(console.log("Credit "+H.value),P.value=l,H.value>0){console.log("Opening page..."),console.log("Header - "+T.value.header),k.value=n.id,p.value=!p.value,T.value=L.getIncomOfferById(n.id),console.log("Here header: "+$.value[0].header),a(n.id,{visitor:x.provider.id});const o=K(n.date);console.log("T.A - "+Y(o))}else h.value=!0,B.value=!0,setTimeout(()=>{B.value=!1},2e3)},r=()=>{I.value=!1},fe=()=>{N.push("pay-plan")},Y=n=>{let l=Date.now()-new Date(n).getTime();l=Math.max(0,l);const o=Math.floor(l/6e4);if(o<60)return`${o} minuuttia sitten`;const C=Math.floor(o/60);return C<24?`${C} tuntia sitten`:`${Math.floor(C/24)} päivää sitten`};return(n,l)=>(i(),z(s($e),null,{default:f(()=>[t("div",Qe,[d(s(re),{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=o=>h.value=o),autohide:"",delay:1e4,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:f(()=>[...l[6]||(l[6]=[g("LUOTTO!! ",-1)])]),small:f(()=>[...l[7]||(l[7]=[])]),default:f(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:l[0]||(l[0]=(...o)=>n.hideError&&n.hideError(...o))}),l[9]||(l[9]=g(" Luotto on vanhentunut, et voi enää toimia! ",-1)),t("div",Ke,[d(s(A),{color:"danger",onClick:fe},{default:f(()=>[...l[8]||(l[8]=[g("Lisää luottoa",-1)])]),_:1})])]),_:1},8,["modelValue"]),I.value?(i(),y("div",nt,[t("p",{style:{"text-align":"right",color:"forestgreen","padding-bottom":"50px"},onClick:r},"Poistu"),l[12]||(l[12]=t("h2",null,"Booking info",-1))])):(i(),y("div",Ye,[(i(!0),y(je,null,De(U.value,(o,C)=>(i(),y("div",{key:C},[o.visitors.some(m=>m===M.provider.id)?(i(),y("div",et,[t("div",tt,[t("span",lt,c(Y(o.started)),1),p.value&&o.id===k.value?(i(),y("span",ot,[d(s(q),{white:"",onClick:l[4]||(l[4]=m=>p.value=!p.value)})])):V("",!0)]),t("span",{class:J({"strong-tilt-move-shake":B.value&&C===P.value})},[t("span",{class:"seen_notification",onClick:m=>e(o,C)},[t("b",null,c(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[11]||(l[11]=t("br",null,null,-1)),g(" "+c(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",at,c(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,st)],2),o.id===k.value?(i(),z(s(ee),{key:0,id:"collapsibleContent2",ref_for:!0,ref:D,modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=m=>p.value=m)},{default:f(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:j,class:"card-body mt-3"},[d(le,{open:F.value,onResizeParent:n.syncParentHeight,onUnlockParent:n.unlockParentHeight,client:T.value},null,8,["open","onResizeParent","onUnlockParent","client"])],512)]),_:1},8,["modelValue"])):V("",!0)])):(i(),y("div",{key:0,class:J(["booking-row-new",[{activePanel:o.id===k.value}]])},[t("div",Je,[t("span",We,c(Y(o.started)),1),p.value&&o.id===k.value?(i(),y("span",Xe,[d(s(q),{white:"",onClick:l[2]||(l[2]=m=>p.value=!p.value)})])):V("",!0)]),t("span",{class:J({"strong-tilt-move-shake":B.value&&C===P.value})},[t("span",{class:"new_notification",onClick:m=>e(o,C)},[t("b",null,c(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[10]||(l[10]=t("br",null,null,-1)),g(" "+c(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",_e,c(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,Ze)],2),o.id===k.value?(i(),z(s(ee),{key:0,id:"collapsibleContent1",ref_for:!0,ref:D,modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=m=>p.value=m)},{default:f(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:j,class:"card-body mt-3"},[d(le,{open:F.value,onResizeParent:n.syncParentHeight,onUnlockParent:n.unlockParentHeight,client:T.value},null,8,["open","onResizeParent","onUnlockParent","client"]),t("p",null,c(o.header),1)],512)]),_:2},1032,["modelValue"])):V("",!0)],2))]))),128))]))])]),_:1}))}}),vt=ue(it,[["__scopeId","data-v-c0e1ab77"]]);export{vt as default};
