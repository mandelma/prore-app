import{C as X,x as N,i as R,o as C,w as f,g as a,b as p,y as h,c as E,z as G,e as d,v as ee,I as we,m as K,h as q,J as ke,r as s,N as he,k as be,D as xe,n as Z,Q as Ce,A as _,E as Me,L as Le,M as De,O as qe,q as Ie,l as Ve,P as Se,R as Pe,t as Oe,S as Te,V as Ee,W as $e}from"./index-DVfyyoyg.js";import{o as Fe,s as Ne}from"./index-BwMeg2vM.js";import{l as He}from"./loadGoogleMap-DZ-zVA3K.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-93e-Jyro.js";const ze=(I,y)=>{const u=new Date(I);return new Date(y)>=u},Ae=(I,y,u)=>{const w=new Date(y),g=new Date(u);return I>=w&&I<g},Be={compare:ze,providerMatchingForClient:Ae},_e={style:{"background-color":"#0b1618",padding:"17px",border:"1px solid #1B2330","border-radius":"8px"}},Re={class:"field-wrapper"},Ue={class:"field-wrapper"},je={class:"field-wrapper"},Ge={key:0,class:"field-footer"},Ke={style:{"margin-top":"17px"},class:"field-wrapper"},We={key:0,class:"field-footer"},Je={class:"message-counter"},Qe=Object.assign({name:"request-form"},{__name:"RequestForm",props:{target:{type:null},date:String},emits:["sendRequest"],setup(I,{emit:y}){const u=I,w=y,g=X({requestHeader:"",requestContent:""}),b=X({}),D=()=>(b.requestHeader=g.requestHeader?"":"Header is required",b.requestContent=g.requestContent?"":"Kuvaus is required",!b.requestHeader&&!b.requestContent);N(()=>g.requestHeader,()=>b.requestHeader=""),N(()=>g.requestContent,()=>b.requestContent="");const P=r=>r instanceof Date&&!isNaN(+r),H=r=>{if(!r)return null;if(r instanceof Date)return P(r)?r:null;if(typeof r=="string"){const c=new Date(r.includes("T")?r:r.replace(",","").replace(" ","T"));if(P(c))return c;let x=r.match(/^(\d{4})-(\d{2})-(\d{2})[,\s]+(\d{2}):(\d{2})(?::(\d{2}))?$/);if(x){const[,V,v,S,M,O,$]=x.map(Number);return new Date(V,v-1,S,M,O,$||0)}if(x=r.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})(?::(\d{2}))?$/),x){const[,V,v,S,M,O,$]=x.map(Number);return new Date(S,v-1,V,M,O,$||0)}}return null},U=r=>{const c=H(r);return P(c)?new Intl.DateTimeFormat("fi-FI",{dateStyle:"long",timeStyle:"short",timeZone:"Europe/Helsinki",hour12:!1,hourCycle:"h23"}).format(c):""},z=()=>{D()?(console.log("Validated"),w("sendRequest",{header:g.requestHeader,content:g.requestContent})):console.log("No validated")};return(r,c)=>(C(),R(d(ke),null,{default:f(()=>[a("form",_e,[a("div",Re,[a("p",null,h(u.target?.address),1)]),a("div",Ue,[a("p",null,h(U(u.date)),1)]),a("div",je,[p(d(ee),{label:"Syötä tilauksen avainsana *",modelValue:g.requestHeader,"onUpdate:modelValue":c[0]||(c[0]=x=>g.requestHeader=x),size:"lg",invalidFeedback:"Ole hyvä ja kirjoita avainsana.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),b.requestHeader?(C(),E("span",Ge,h(b.requestHeader),1)):G("",!0),a("div",Ke,[p(d(we),{maxlength:"70",label:"Kuvaus tilauksen sisällöstä *",rows:"3",modelValue:g.requestContent,"onUpdate:modelValue":c[1]||(c[1]=x=>g.requestContent=x),invalidFeedback:"Ole hyvä ja kirjoita tehtävän kuvaus.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),b.requestContent?(C(),E("span",We,h(b.requestContent),1)):G("",!0),a("span",Je,h(g.requestContent.length)+" / 70",1)])]),p(d(K),{color:"primary",onClick:z},{default:f(()=>[...c[2]||(c[2]=[q("Kinnita",-1)])]),_:1})])]),_:1}))}}),Ye=te(Qe,[["__scopeId","data-v-de75f0dd"]]),Xe={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},Ze={key:0,class:"client-map-panel"},et={style:{display:"flex","justify-content":"right"}},tt={class:"input-group"},ot={class:"field-wrapper"},at={key:0},lt={key:1},nt={class:"flex items-center gap-2"},st={class:"distSelectPanel"},it={class:"field-wrapper"},rt={style:{"margin-top":"15px"}},dt={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},ut={style:{padding:"13px 0 20px 0"}},ct=Object.assign({name:"pro-around"},{__name:"ProAround",setup(I){const y=s(null),u=s(null),w=s(null),g=s(!1),b=Fe,D=s(""),P=s(!1),H=s(!1),U=s(""),z=s(!1),r=s(null);s(0),s(!1);const c=s(!0),x=s(null),V=s(0),v=s(null),S=s(null),M=s(null),O=Be,$=s(0),A=s(!1),B=s(!1),W=s(null),J=s(!1),oe=s(""),ae=he(),le=be(),ne=s([{text:"1 km",value:1},{text:"10 km",value:10},{text:"20 km",value:20},{text:"30 km",value:30},{text:"40 km",value:40},{text:"50 km",value:50},{text:"60 km",value:60},{text:"70 km",value:70},{text:"80 km",value:80},{text:"90 km",value:90},{text:"100 km",value:100},{text:"200 km",value:200},{text:"300 km",value:300}]);N(H,t=>{t&&(console.log("Ready? "+t),N(r,e=>{console.log("Dist is changed ",e),pe(D.value.label,e)},{immediate:!0}))}),N(A,t=>{if(t){v.value=ie(new Date),V.value++;const o=new Date().toLocaleString("fi-FI",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",","");S.value=o}else v.value=null,S.value=null,V.value++});const se=()=>{console.log("Changed "+D.value.label),U.value=D.value.label,z.value=!0};function ie(t=new Date){const e=n=>String(n).padStart(2,"0"),l=t.getFullYear(),o=e(t.getMonth()+1),i=e(t.getDate()),m=e(t.getHours()),L=e(t.getMinutes());return`${l}-${o}-${i}, ${m}:${L}`}const re=async()=>{try{await He(),console.log("Map is inited in pro around! ✅"),de();const t=document.getElementById("client-input"),e={lat:50.064192,lng:-130.605469},o={bounds:{north:e.lat+.1,south:e.lat-.1,east:e.lng+.1,west:e.lng-.1},componentRestrictions:{country:"fi"},fields:["address_components","geometry","icon","name","formatted_address"],strictBounds:!1},i=new google.maps.places.Autocomplete(t,o);i.addListener("place_changed",()=>{let m=i.getPlace();u.value=m.geometry.location.lat(),w.value=m.geometry.location.lng(),console.log("Address xxxx "+m.formatted_address),console.log("place-----lat------"+u.value)});try{new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(u.value,w.value),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50})}catch(m){console.log("Error to load map: "+m.message)}}catch(t){console.error("Google Maps failed to load ❌",t),g.value=!0}},de=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{const{latitude:e,longitude:l}=t.coords;u.value=e,w.value=l,console.log("myLat "+e),ue(e,l)})},ue=(t,e)=>{try{console.log("Map is loading...");const l=document.getElementById("map");if(!l)throw new Error("Map container #map not found");if(!(l instanceof HTMLElement))throw new Error("Map container is not an HTMLElement");const o=new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50}),i=document.getElementById("spinner");google.maps.event.addListenerOnce(o,"tilesloaded",()=>{console.log("tiles loaded"),i.style.opacity="0",setTimeout(()=>i.style.display="none",400),H.value=!0})}catch(l){console.log("Error to load map: "+l.message)}ce(t,e)},ce=(t,e)=>{Oe.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&key=AIzaSyDt2YXE5tk0J72JgqnH3DTD7MeoqbbWBmU").then(l=>{l.data.error_message?console.log(l.data.error_message):(new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP}),y.value=l.data.results[1].formatted_address)}).catch(l=>{console.log(l.message)})},Q=(t,e,l,o)=>{var i=new google.maps.LatLng(t,e),m=new google.maps.LatLng(l,o);return(google.maps.geometry.spherical.computeDistanceBetween(i,m)/1e3).toFixed(2)},me=async(t,e,l)=>{if(!window.google||!window.google.maps){console.error("Google Maps not loaded yet");return}console.log("Profession and dist... "+e+" "+l),console.log("lat - "+u.value);let o=!1,i=new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(u.value,w.value),mapTypeId:google.maps.MapTypeId.ROADMAP});console.log("Users count: "+t.length),console.log("Current distance "+l);let m;v.value&&(console.log("Booking date 2 "+new Date(v.value)),m=new Date(v.value));let L=0;if(t.length>0){for(let n=0;n<t.length;n++)console.log("-----Firma------- "+t[n].pName),u.value,w.value,t[n].profession.forEach(Y=>{if(Y===e&&(console.log("Pro "+Y),t[n].latitude,t[n].longitude,console.log("Distance btw "+Q(u.value,w.value,t[n].latitude,t[n].longitude)),Q(u.value,w.value,t[n].latitude,t[n].longitude)<=l)){L++;let T;t[n].isAvailable24_7?T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].yritys,icon:this.pinSymbol("seagreen","darkgreen"),label:{color:"green",fontWeight:"bold",fontSize:"14px"}}):t[n].timetable.length>0?t[n].timetable.map(k=>{console.log("Date: "+k.start),console.log("Fitting datetime: "+O.providerMatchingForClient(m,k.start,k.end)),O.providerMatchingForClient(m,k.start,k.end)||t[n].isAvailable24_7?T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:j("seagreen","darkgreen")}):T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:j("orange","darkorange")})}):T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:j("orange","darkorange")}),window.myGlobalFunction=this&&this.openMarker?this.openMarker.bind(this):k=>ge(t[k]);const F=new google.maps.InfoWindow;F.addListener("domready",()=>{const k=document.querySelector(".gm-ui-hover-effect");k&&(k.style.display="none"),document.getElementById("custom-close")?.addEventListener("click",()=>F.close())}),T.addListener("click",()=>{console.log("POOOOS",n);const k=n;o&&o.close(),o=F,F.setContent(`
                <div class="custom-info">
                  <div style="display: flex; justify-content: right;">
                    <button id="custom-close">×</button>
                  </div>
                  
                  <h3>My Place</h3>
                  <p>Hello world!</p>
                  <div>
                  <p style="color: green;">${t[k].pName}</p>
                  <p style="color: red;" onclick="myGlobalFunction(${k})">Tiedot</p>
                </div>
                </div>
                `),F.open({anchor:T,map:i,shouldFocus:!1})})}});$.value=L,L>0?(console.log("Pro count existing..."),c.value=!1):console.log("Pro count not existing..."),x.value=L,console.log("countxx "+L)}},pe=async(t,e)=>{console.log("Current distance herexx  ");const l=await $e.getProviders();l&&me(l,t,e)},ge=t=>{console.log("Ordered company: "+t.pName),M.value=t,W.value=t,B.value=!0},ve=t=>{const e=t?.match(/^(\d{2})\/(\d{2})\/(\d{4}),?\s+(\d{2}):(\d{2})$/);if(!e)return null;const[,l,o,i,m,L]=e.map(Number);return new Date(i,o-1,l,m,L)},fe=async t=>{const e=await le.user.id,l=M.value.user.id;console.log("Sending request to "+M.value.user.username);const o=ve(v.value);let i;o?(i=o.getTime(),console.log("Milliseconds:",i)):console.log("Invalid date string");const m={created:o,created_ms:i,dateStr:v.value,header:t.header,agreement:!1,address:y.value,latitude:u.value,longitude:w.value,zone:0,professional:D.value.label,isIncludeOffers:!1,description:t.content,status:"pending"};B.value=!1,ae.onRequest(l,e,M.value.id,m)};xe(async()=>{await re()});const ye=()=>{P.value=!1,y.value=""},j=(t,e)=>{const l=document.createElement("div");return l.className="price-tag",l.textContent="$2.5M",{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:t,fillOpacity:1,strokeColor:e,strokeWeight:2,scale:1,labelOrigin:{x:60,y:-25}}};return(t,e)=>{const l=Ie("HandleToast");return C(),E(Pe,null,[a("div",null,[a("div",Xe,[c.value?(C(),E("div",Ze,[a("div",et,[p(d(Z),{size:"lg",style:{padding:"10px"},onClick:e[0]||(e[0]=o=>c.value=!1)},{default:f(()=>[...e[13]||(e[13]=[a("i",{class:"fas fa-expand-arrows-alt"},null,-1)])]),_:1}),a("div",null,[p(d(Ce),{white:"",style:{padding:"10px"},size:"sm",onClick:e[1]||(e[1]=o=>t.$router.go(-1))})])]),a("div",{class:_([{hideClientInput:!y.value&&P.value},"field-wrapper"]),style:{width:"100%"}},[a("div",tt,[p(d(ee),{size:"sm",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=o=>y.value=o),label:"Anna osoite",id:"client-input",placeholder:"",wrapperClass:"form-outline flex-grow-3",inputClass:"ps-0","aria-describedby":"button-addon2"},null,8,["modelValue"]),y.value?(C(),R(d(K),{key:0,type:"button",style:{border:"1px solid #ddd"}},{default:f(()=>[p(d(Z),{size:"1x",onClick:e[3]||(e[3]=o=>ye())},{default:f(()=>[...e[14]||(e[14]=[a("i",{class:_("fas fa-times")},null,-1)])]),_:1})]),_:1})):G("",!0)])],2),a("div",ot,[a("div",null,[p(d(Ne),{style:Me([{width:"100%"},t.isNoPro?"color: pink; border: 1px solid red;":"color: white;"]),modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=o=>D.value=o),onChange:se,options:d(b),filter:"",optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Valitse ammattilainen *",class:"w-full md:w-[30rem]"},{value:f(o=>[o.value?(C(),E("div",at,[a("div",null,h(o.value.label),1)])):(C(),E("span",lt,h(o.placeholder),1))]),optiongroup:f(o=>[a("div",nt,[a("i",{class:_(o.option.icon),style:{"font-size":"17px",color:"cadetblue"}},null,2),e[15]||(e[15]=q("    ",-1)),a("span",null,h(o.option.label),1)])]),_:1},8,["modelValue","options","style"])])]),a("div",{class:_({hideDistSelectPanel:!z.value})},[e[16]||(e[16]=a("p",{style:{"text-align":"left"}},"Valitse kiinnostavaa ajankohta tai heti!",-1)),a("div",st,[a("div",it,[(C(),R(d(Le),{size:"lg",label:"Valitse tehtävän päivämäärä ja aika",modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),datepicker:{...t.L},timepicker:{...t.L,hoursFormat:24},key:V.value,disablePast:""},null,8,["modelValue","datepicker","timepicker"]))]),q(" isDateNow "+h(A.value)+" date "+h(S.value)+" ",1),a("div",rt,[p(d(De),{label:"Heti!",name:"selection",modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=o=>A.value=o),value:"true",onClick:t.removeDateIfExist,wrapperClass:"mb-4"},null,8,["modelValue","onClick"])]),q(" dt "+h(v.value),1)])],2),p(d(qe),{size:"sm",white:"",selected:r.value,"onUpdate:selected":e[7]||(e[7]=o=>r.value=o),options:ne.value,label:"Etsi alue",id:"distance"},null,8,["selected","options"])])):(C(),R(d(K),{key:1,color:"primary",style:{position:"absolute",opacity:"0.8",top:"60px",left:"80%","z-index":"2"},onClick:e[8]||(e[8]=o=>c.value=!0)},{default:f(()=>[...e[17]||(e[17]=[q(" Paneeli ",-1)])]),_:1}))]),e[21]||(e[21]=q(" /* ",-1)),a("div",dt,[p(l,{modelValue:t.toastModel,"onUpdate:modelValue":e[9]||(e[9]=o=>t.toastModel=o),"toast-name":t.toastState,"icon-state":t.toastIcon,text:t.toastContent},null,8,["modelValue","toast-name","icon-state","text"])]),e[22]||(e[22]=q(" */ ",-1)),a("div",ut,[p(d(Ve),{modelValue:J.value,"onUpdate:modelValue":e[11]||(e[11]=o=>J.value=o),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:f(()=>[...e[18]||(e[18]=[q("PROKEIKKATORI",-1)])]),small:f(()=>[...e[19]||(e[19]=[])]),default:f(()=>[a("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[10]||(e[10]=(...o)=>t.hideError&&t.hideError(...o))}),a("p",null,h(oe.value),1)]),_:1},8,["modelValue"])]),a("div",null,[p(d(Se),{tabindex:"-1",centered:"",modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=o=>B.value=o)},{default:f(()=>[p(d(Te),null,{default:f(()=>[...e[20]||(e[20]=[a("h2",null,"Pro data here",-1)])]),_:1}),p(d(Ee),null,{default:f(()=>[a("p",null,"Tällä - "+h(W.value.pName)+" - tiedot...",1),p(Ye,{target:M.value,date:v.value,onSendRequest:fe},null,8,["target","date"])]),_:1})]),_:1},8,["modelValue"])])]),e[23]||(e[23]=a("div",{id:"map-container"},[a("div",{id:"map"}),a("div",{id:"spinner",class:"spinner-overlay"},[a("div",{class:"spinner"})])],-1))],64)}}}),yt=te(ct,[["__scopeId","data-v-d9e2bad4"]]);export{yt as default};
