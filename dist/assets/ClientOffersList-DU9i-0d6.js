import{aX as ne,k as ce,a as se,N as ae,aY as Z,r as d,a2 as X,B as ie,D as re,aZ as ye,c as y,o as u,g as t,b as f,w as v,h as g,e as n,l as ue,T as ge,y as c,a_ as ke,n as be,m as A,z as V,i as T,F as Oe,Q as G,v as Ce,a6 as _,I as ee,H as Ve,aU as Pe,a$ as we,Y as Be,J as $e,f as De,R as Ie,aD as je,A as W,b0 as te,K as Ae,b1 as le}from"./index-DVfyyoyg.js";import{l as Te}from"./loadGoogleMap-DZ-zVA3K.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-93e-Jyro.js";const ze={style:{padding:"13px 0 20px 0"}},Ee={key:0},he={key:1,style:{"border-top":"1px solid grey"}},Le={style:{display:"flex","justify-content":"right"}},Me={key:0,style:{"margin-bottom":"20px"}},Re={key:0},xe={class:"card card-body"},Ne={class:"mt-3"},Ue={style:{padding:"13px","font-size":"14px","margin-bottom":"20px"}},He={style:{display:"flex","justify-content":"right","margin-bottom":"13px"}},Se={style:{"text-align":"left","margin-bottom":"10px"}},Fe={key:1,style:{"margin-bottom":"20px"}},qe={key:1,style:{padding:"13px","margin-top":"13px",border:"1px solid blue"}},Ge={style:{display:"flex","justify-content":"right","margin-bottom":"7px"}},Qe=Object.assign({name:"client-offer"},{__name:"ClientOffer",props:{client:{type:Object,default:()=>({})},open:{type:Boolean,default:!1}},setup(U){const x=U,{client:i,open:fe}=ne(x),H=ce(),L=se();ae();const b=Z("resizeParent"),M=Z("unlockParent");function $(){typeof b=="function"&&b()}function Q(){typeof M=="function"&&M()}const z=ye,D=d(null),E=d(null),h=d(!1),{user:p}=X(H),{providerId:S,provider:I}=X(L),k=d(null),P=d("here"),N=d(""),O=d(""),j=d(!1);d(!0);const w=d(!1);d(null),ie(()=>x.client?.professional?.[0]?.profession||"");const B={bookingID:i.value.id,sender:p.value.id,isNewOffer:!0,name:I.value.pName,placeOrGo:P.value,area:i.value.zone,distance:D?.value,duration:E?.value,price:k.value,description:N.value,place:P.value,provider:S.value};re(async()=>{await F()});const F=async()=>{try{await Te(),console.log("Map is inited in ClientOffer! ✅"),console.log("CXC "+await z.findDistance([I.value.latitude,I.value.longitude],[i.value.latitude,i.value.longitude]));const r=await z.findDistance([I.value.latitude,I.value.longitude],[i.value.latitude,i.value.longitude]);r&&(console.log("Distance is "+r.distance),console.log("Duration is "+r.duration),D.value=r.distance,E.value=r.duration);const e=document.getElementById("client-location");if(!e)throw new Error("#client-location not found in DOM");const s=new google.maps.Map(e,{zoom:11,center:new google.maps.LatLng(i.value.latitude,i.value.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP});new google.maps.Marker({position:{lat:i.value.latitude,lng:i.value.longitude},map:s}),google.maps.event.addListenerOnce(s,"idle",()=>{const a=document.getElementById("spinner");a&&(a.style.display="none")})}catch(r){console.error("Google Maps failed to load ❌",r),w.value=!0;const e=document.getElementById("spinner");e&&(e.style.display="none")}},K=()=>{console.log("Make offer!"),h.value=!0},R=()=>{console.log("Creating offer! "+k.value);const r=i.value.user.id;console.log("Addressee - "+r),L.addProviderOffer(i.value.id,r,B)},Y=()=>{confirm("Oletko varmaa että tilaus poistetaan?")?console.log("Quit offer"):console.log("Keskeytetty poistaminen!")},J=async()=>{console.log("client user id: "+i.value.user.id);const r=i.value.user.id,e=i.value.id;await L.onConfirmClientBooking(i.value.id,B),we.emit("on client request confirm",r,e,B)},q=()=>{console.log("Reject / poista"),confirm("Oletko varmaa, että haluat poistaa tilauksen!?")===!0?(j.value=!0,console.log("Reject"),L.removeBookingOffer(i.value.id)):console.log("You canceled!")};return(r,e)=>(u(),y("div",null,[t("div",ze,[f(n(ue),{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:v(()=>[...e[12]||(e[12]=[g("VIRHE LOMAKEELLA! ",-1)])]),small:v(()=>[...e[13]||(e[13]=[])]),default:v(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[0]||(e[0]=(...s)=>r.hideError&&r.hideError(...s))}),e[14]||(e[14]=g(" ⚠️ We couldn’t load Google Maps right now. Please check your network connection and try again later. ",-1))]),_:1},8,["modelValue"])]),!n(i).professional&&!r.road?(u(),y("div",Ee,[f(n(ge),{color:"info"})])):(u(),y("div",he,[f(n(ke),{borderless:"",style:{"font-size":"12px",color:"#dddddd","text-align":"left"}},{default:v(()=>[t("tbody",null,[t("tr",null,[e[15]||(e[15]=t("td",null," Osoite: ",-1)),t("td",null,c(n(i).address),1)]),t("tr",null,[e[16]||(e[16]=t("td",null," Tarvitaan ammattilaista: ",-1)),t("td",null,c(n(i)?.professional?.[0]),1)]),t("tr",null,[e[17]||(e[17]=t("td",null," Ajankohda: ",-1)),t("td",null,c(n(i).date),1)]),t("tr",null,[e[18]||(e[18]=t("td",null," Tehtävän kuvaus: ",-1)),t("td",null,c(n(i).description),1)]),e[21]||(e[21]=t("tr",null,[t("td",null," Kuvat tehtävästä: "),t("td")],-1)),t("tr",null,[e[19]||(e[19]=t("td",null," Etäisyys ",-1)),t("td",null,c(D.value),1)]),t("tr",null,[e[20]||(e[20]=t("td",null," Matkan aikaa: ",-1)),t("td",null,c(E.value),1)]),e[22]||(e[22]=t("tr",null,[t("td",null,"Sijainti"),t("td",null,[t("div",{id:"map-container"},[t("div",{id:"client-location"}),t("div",{id:"spinner",class:"spinner-overlay"},[t("div",{class:"spinner"})])])])],-1)),e[23]||(e[23]=t("tr",null,[t("td"),t("td")],-1))])]),_:1}),t("div",Le,[f(n(A),{color:"primary",class:"mb-3"},{default:v(()=>[f(n(be),{size:"2x"},{default:v(()=>[...e[24]||(e[24]=[t("i",{class:"far fa-comment"},null,-1)])]),_:1})]),_:1})]),n(i).isIncludeOffers?(u(),y("div",Me,[n(i).offers.some(s=>s.bookingID===n(i).id)?V("",!0):(u(),y("div",Re,[f(n(A),{disabled:r.isDisableProNotOfferBtns,class:"mb-3",block:"",color:"primary",size:"lg",onClick:e[2]||(e[2]=s=>K(r.booking))},{default:v(()=>[...e[25]||(e[25]=[g(" Tee Hintatarjous ",-1)])]),_:1},8,["disabled"]),f(Pe,{name:"fade-slide",onBeforeEnter:$,onEnter:$,onAfterEnter:Q,onBeforeLeave:$,onLeave:$,onAfterLeave:Q},{default:v(()=>[Oe(t("div",xe,[t("div",Ne,[t("div",Ue,[t("div",He,[f(n(G),{white:"",onClick:e[3]||(e[3]=s=>h.value=!1)})]),t("form",null,[f(n(Ce),{type:"number",label:"Tarjoa hintasi",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=s=>k.value=s),wrapperClass:"mb-4"},null,8,["modelValue"]),t("div",Se,[f(n(_),{label:"Tarjoan palvelu asiakkaan luona",name:"area",modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=s=>P.value=s),value:"go"},null,8,["modelValue"]),f(n(_),{label:"Tarjoan palvelua paikalla",name:"area",modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=s=>P.value=s),value:"here"},null,8,["modelValue"])]),f(n(ee),{style:{},label:"Anna tarvittaessa lisäselvityksiä...",rows:"3",modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=s=>N.value=s)},null,8,["modelValue"]),k.value?(u(),T(n(A),{key:0,disabled:r.isDisableProNotOfferBtns,label:"Anna hintatarjous",block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:R},{default:v(()=>[...e[26]||(e[26]=[g(" Lähetä ",-1)])]),_:1},8,["disabled"])):V("",!0)])])])],512),[[Ve,h.value]])]),_:1}),h.value?V("",!0):(u(),T(n(A),{key:0,disabled:r.isDisableProNotOfferBtns,block:"",outline:"danger",onClick:q,size:"lg"},{default:v(()=>[...e[27]||(e[27]=[g("Poista tilaus",-1)])]),_:1},8,["disabled"]))]))])):(u(),y("div",Fe,[j.value?V("",!0):(u(),T(n(A),{key:0,disabled:r.isDisableProNotMapBtns,block:"",outline:"success",size:"lg",onClick:e[8]||(e[8]=s=>J())},{default:v(()=>[...e[28]||(e[28]=[g(" Varmista tilaus ",-1)])]),_:1},8,["disabled"])),j.value?(u(),y("div",qe,[t("div",Ge,[f(n(G),{white:"",onClick:e[9]||(e[9]=s=>j.value=!1)})]),f(n(ee),{style:{},label:"Anna syy...",rows:"3",modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=s=>O.value=s)},null,8,["modelValue"]),O.value.length>1?(u(),T(n(A),{key:0,disabled:r.isDisableProNotMapBtns,block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:e[11]||(e[11]=s=>r.confirmRejectBookingNoOffers(r.booking))},{default:v(()=>[...e[29]||(e[29]=[g(" Varmista ",-1)])]),_:1},8,["disabled"])):V("",!0)])):V("",!0),j.value?V("",!0):(u(),T(n(A),{key:2,block:"",outline:"danger",size:"lg",onClick:Y},{default:v(()=>[...e[30]||(e[30]=[g(" Poista tilaus ",-1)])]),_:1}))]))]))]))}}),oe=de(Qe,[["__scopeId","data-v-952a4cb0"]]),Ke={style:{"padding-top":"17px"}},Ye={style:{float:"right",padding:"10px"}},Je={key:0},We={class:"line"},Xe={class:"left-item"},Ze={key:0,class:"right-item"},_e=["onClick"],et={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},tt={key:1,class:"booking-row-seen"},lt={class:"line"},ot={class:"left-item"},nt={key:0,class:"right-item"},st=["onClick"],at={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},it={key:1},rt=Object.assign({name:"client-offers-list"},{__name:"ClientOffersList",props:{isPro:{type:Boolean},provider:{type:Object},offersIn:{type:Array,default:()=>[]},credit:{type:Number}},setup(U){ae();const x=U,{offersIn:i,isPro:fe,credit:H}=ne(x),L=De(),b=d(23),M=se(),{incomingOffers:$,providerId:Q}=X(M),z=d({}),D=d(!1),E=d(!1),h=d(!1),p=d(!1),S=d(!1),I=d(null),k=d(0),P=d(0),N=ie(()=>Array.isArray($.value)?$.value:[]),O=d(null);function j(a){O.value=a?.$el??a??null}let w=0,B=0;function F(){const a=O.value;!p.value||!a||(w&&cancelAnimationFrame(w),B&&cancelAnimationFrame(B),w=requestAnimationFrame(()=>{B=requestAnimationFrame(()=>{const l=O.value;!l||!p.value||(l.style.height=l.scrollHeight+"px")})}))}function K(){w&&cancelAnimationFrame(w),B&&cancelAnimationFrame(B),O.value&&requestAnimationFrame(()=>{const l=O.value;l&&(l.style.height="")})}le("resizeParent",F),le("unlockParent",K);let R;re(()=>{"ResizeObserver"in window&&(R=new ResizeObserver(()=>F()),O.value&&R.observe(O.value))}),Be(()=>{R&&R.disconnect()});function Y(a){const[l,o]=a.split(", "),[C,m,ve]=l.split("/").map(Number),[pe,me]=o.split(":").map(Number);return new Date(ve,m-1,C,pe,me)}const J=async(a,l)=>{await Ae.addVisitor(a,l),console.log("VISITOR id is "+l.visitor),M.addVisitorForBooking(a,l)},q=async(a,l)=>{if(console.log("Credit "+H.value),P.value=l,H.value>0){console.log("Opening page..."),console.log("Header - "+z.value.header),k.value=a.id,p.value=!p.value,z.value=M.getIncomOfferById(a.id),console.log("Here header: "+$.value[0].header),J(a.id,{visitor:x.provider.id});const o=Y(a.date);console.log("T.A - "+s(o))}else E.value=!0,D.value=!0,setTimeout(()=>{D.value=!1},2e3)},r=()=>{h.value=!1},e=()=>{L.push("pay-plan")},s=a=>{let l=Date.now()-new Date(a).getTime();l=Math.max(0,l);const o=Math.floor(l/6e4);if(o<60)return`${o} minuuttia sitten`;const C=Math.floor(o/60);return C<24?`${C} tuntia sitten`:`${Math.floor(C/24)} päivää sitten`};return(a,l)=>(u(),T(n($e),null,{default:v(()=>[t("div",Ke,[f(n(ue),{modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=o=>E.value=o),autohide:"",delay:1e4,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:v(()=>[...l[6]||(l[6]=[g("LUOTTO!! ",-1)])]),small:v(()=>[...l[7]||(l[7]=[])]),default:v(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:l[0]||(l[0]=(...o)=>a.hideError&&a.hideError(...o))}),l[9]||(l[9]=g(" Luotto on vanhentunut, et voi enää toimia! ",-1)),t("div",Ye,[f(n(A),{color:"danger",onClick:e},{default:v(()=>[...l[8]||(l[8]=[g("Lisää luottoa",-1)])]),_:1})])]),_:1},8,["modelValue"]),h.value?(u(),y("div",it,[t("p",{style:{"text-align":"right",color:"forestgreen","padding-bottom":"50px"},onClick:r},"Poistu"),l[12]||(l[12]=t("h2",null,"Booking info",-1))])):(u(),y("div",Je,[(u(!0),y(Ie,null,je(N.value,(o,C)=>(u(),y("div",{key:C},[o.visitors.some(m=>m===U.provider.id)?(u(),y("div",tt,[t("div",lt,[t("span",ot,c(s(o.started)),1),p.value&&o.id===k.value?(u(),y("span",nt,[f(n(G),{white:"",onClick:l[4]||(l[4]=m=>p.value=!p.value)})])):V("",!0)]),t("span",{class:W({"strong-tilt-move-shake":D.value&&C===P.value})},[t("span",{class:"seen_notification",onClick:m=>q(o,C)},[t("b",null,c(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[11]||(l[11]=t("br",null,null,-1)),g(" "+c(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",at,c(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,st)],2),o.id===k.value?(u(),T(n(te),{key:0,id:"collapsibleContent2",ref_for:!0,ref:j,modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=m=>p.value=m)},{default:v(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:I,class:"card-body mt-3"},[f(oe,{open:S.value,onResizeParent:a.syncParentHeight,onUnlockParent:a.unlockParentHeight,client:z.value},null,8,["open","onResizeParent","onUnlockParent","client"])],512)]),_:1},8,["modelValue"])):V("",!0)])):(u(),y("div",{key:0,class:W(["booking-row-new",[{activePanel:o.id===k.value}]])},[t("div",We,[t("span",Xe,c(s(o.started)),1),p.value&&o.id===k.value?(u(),y("span",Ze,[f(n(G),{white:"",onClick:l[2]||(l[2]=m=>p.value=!p.value)})])):V("",!0)]),t("span",{class:W({"strong-tilt-move-shake":D.value&&C===P.value})},[t("span",{class:"new_notification",onClick:m=>q(o,C)},[t("b",null,c(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[10]||(l[10]=t("br",null,null,-1)),g(" "+c(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",et,c(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,_e)],2),o.id===k.value?(u(),T(n(te),{key:0,id:"collapsibleContent1",ref_for:!0,ref:j,modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=m=>p.value=m)},{default:v(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:I,class:"card-body mt-3"},[f(oe,{open:S.value,onResizeParent:a.syncParentHeight,onUnlockParent:a.unlockParentHeight,client:z.value},null,8,["open","onResizeParent","onUnlockParent","client"]),t("p",null,c(o.header),1)],512)]),_:2},1032,["modelValue"])):V("",!0)],2))]))),128))]))])]),_:1}))}}),pt=de(rt,[["__scopeId","data-v-c0e1ab77"]]);export{pt as default};
