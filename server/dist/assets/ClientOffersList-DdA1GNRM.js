import{_ as pe,aY as ye,k as he,aZ as Ve,a as ge,N as ke,a_ as re,r as u,O as se,B as be,D as Ce,a$ as we,c as y,o as d,g as t,b as f,w as v,h as g,e as s,l as ne,T as Pe,y as p,b0 as Ee,n as Ie,m as j,z as V,i as R,F as Te,Q as _,v as $e,a7 as ue,I as de,H as Ae,aV as fe,K as ie,$ as je,J as Be,f as Me,S as Ne,aE as De,A as ae,b1 as ve,b2 as ce}from"./index-G9ZV8JxE.js";import{l as Le}from"./loadGoogleMap-DZ-zVA3K.js";import"./index-93e-Jyro.js";const Re={style:{padding:"13px 0 20px 0"}},xe={key:0},ze={key:1,style:{"border-top":"1px solid grey"}},Se={style:{display:"flex","justify-content":"right"}},Ue={key:0,style:{"margin-bottom":"20px"}},Fe={key:0},He={class:"card card-body"},Ke={class:"mt-3"},Ge={style:{padding:"13px","font-size":"14px","margin-bottom":"20px"}},qe={style:{display:"flex","justify-content":"right","margin-bottom":"13px"}},Je={class:"form-card"},Qe={style:{"text-align":"left","margin-bottom":"10px"}},_e={key:1,style:{"margin-bottom":"20px"}},We={key:0,style:{padding:"13px","margin-top":"13px",border:"1px solid grey"},class:"form-card"},Ye={style:{display:"flex","justify-content":"right","margin-bottom":"7px"}},Xe=Object.assign({name:"client-offer"},{__name:"ClientOffer",props:{client:{type:Object,default:()=>({})},open:{type:Boolean,default:!1},isDisabled:{type:Boolean}},emits:["confirmed-order-toast","just-test"],setup(B,{emit:W}){const H=B,Y=W,{client:a,open:Oe}=ye(H),K=he(),G=Ve(),b=ge();ke();const x=re("resizeParent"),z=re("unlockParent");function P(){typeof x=="function"&&x()}function E(){typeof z=="function"&&z()}const M=we,A=u(null),c=u(null),N=u(!1),{user:S}=se(K),{providerId:I,provider:k}=se(b),w=u(null),h=u("here"),D=u(""),C=u(""),T=u(!1);u(!0);const $=u(!1);u(null),be(()=>H.client?.professional?.[0]?.profession||""),Ce(async()=>{await L()});const L=async()=>{try{await Le(),console.log("Map is inited in ClientOffer! ✅"),console.log("CXC "+await M.findDistance([k.value.latitude,k.value.longitude],[a.value.latitude,a.value.longitude]));const r=await M.findDistance([k.value.latitude,k.value.longitude],[a.value.latitude,a.value.longitude]);r&&(console.log("Distance is "+r.distance),console.log("Duration is "+r.duration),A.value=r.distance,c.value=r.duration);const e=document.getElementById("client-location");if(!e)throw new Error("#client-location not found in DOM");const i=new google.maps.Map(e,{zoom:11,center:new google.maps.LatLng(a.value.latitude,a.value.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP});new google.maps.Marker({position:{lat:a.value.latitude,lng:a.value.longitude},map:i}),google.maps.event.addListenerOnce(i,"idle",()=>{const n=document.getElementById("spinner");n&&(n.style.display="none")})}catch(r){console.error("Google Maps failed to load ❌",r),$.value=!0;const e=document.getElementById("spinner");e&&(e.style.display="none")}},q=()=>{console.log("Chat btn")},X=()=>{console.log("Make offer!"),N.value=!0},U=()=>{console.log("Creating offer! "+w.value);const r={bookingID:a.value.id,sender:S.value.id,isNewOffer:!0,name:k.value.pName,placeOrGo:h.value,area:a.value.zone,distance:A?.value,duration:c?.value,price:w.value,description:D.value,place:h.value,provider:I.value};console.log("Client in top: "+{}.value);const e=a.value.author_id;console.log("Addressee - "+e),b.addProviderOffer(a.value.id,e,r)},Z=async()=>{T.value=!0},ee=async()=>{if(confirm("Oletko varmaa että tilaus poistetaan?")){console.log("Quit offer user - "+a.value.author_id),console.log(Object.keys(a.value.user));const r=a.value.id,e=a.value.author_id,i="Tilaus hylätty!",n=`${k.value.pName} ei hyväksynyt lähettämääsi tilausta "${a.value.header}". Syyksi ilmoitettu: ${C.value}!`;console.log("111"),await b.removeMapOffer(r,e),console.log("222"),await G.addNotification(r,k.value.pName,i,n,e)}else console.log("Keskeytetty poistaminen!")},te=()=>{T.value=!1,C.value=""},le=async()=>{console.log("client user id: "+a.value.author_id),console.log("Client user name?? "+a.value.user.firstName),a.value.author_id;const r=S.value.id,e=a.value.id,i="Sopimus tehty!",n=`${k.value.pName} on vahvistanut tilauksen - "${a.value.header}". Tarkemmat tiedot kalenterissa!`,l=`Tilaus "${a.value.header}" on vahvistettu. Tiedot kalenterissa!`,o={bookingID:a.value.id,sender:S.value.id,isNewOffer:!0,name:k.value.pName,placeOrGo:h.value,area:a.value.zone,distance:A?.value,duration:c?.value,price:w.value,description:D.value,place:h.value,provider:I.value},O={bookingId:e,isNewMsg:!0,isLink:!0,title:i,content:n,reason:"",sender:k.value.pName},m={bookingId:e,isNewMsg:!0,isLink:!0,title:i,content:l,reason:"",sender:k.value.pName},oe={cNote:O,pNote:m};console.log("Button clicked in child");try{const F=await ie.updateRecipientStatus(e,{status:"confirmed"}),Q=await ie.addConfirmedOffer(e,o);if(!F||!Q)return;Y("just-test"),await b.onClientBooking(a.value.id,o,r,a.value.author_id,oe),console.log("Child about to emit confirmed-order-toast (TEMP ALWAYS)"),console.log("API results:",{confirmation:F,addConfirmation:Q})}catch(F){console.error("API error in child:",F)}},J=async()=>{if(confirm("Oletko varmaa, että haluat poistaa tilauksen kokonaan?")){T.value=!0,console.log("Reject");const r=a.value.author_id;console.log("RECEIVER - "+r),await b.removeBookingPublicOffer(a.value.id,r)}else console.log("Cancelled")};return(r,e)=>(d(),y("div",null,[t("div",Re,[f(s(ne),{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=i=>$.value=i),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:v(()=>[...e[10]||(e[10]=[g("VIRHE LOMAKEELLA! ",-1)])]),small:v(()=>[...e[11]||(e[11]=[])]),default:v(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[0]||(e[0]=(...i)=>r.hideError&&r.hideError(...i))}),e[12]||(e[12]=g(" ⚠️ We couldn’t load Google Maps right now. Please check your network connection and try again later. ",-1))]),_:1},8,["modelValue"])]),!s(a).professional&&!r.road?(d(),y("div",xe,[f(s(Pe),{color:"info"})])):(d(),y("div",ze,[f(s(Ee),{borderless:"",style:{"font-size":"12px",color:"#dddddd","text-align":"left"}},{default:v(()=>[t("tbody",null,[t("tr",null,[e[13]||(e[13]=t("td",null," Osoite: ",-1)),t("td",null,p(s(a).address),1)]),t("tr",null,[e[14]||(e[14]=t("td",null," Tarvitaan ammattilaista: ",-1)),t("td",null,p(s(a)?.professional?.[0]),1)]),t("tr",null,[e[15]||(e[15]=t("td",null," Ajankohda: ",-1)),t("td",null,p(s(a).date),1)]),t("tr",null,[e[16]||(e[16]=t("td",null," Tehtävän kuvaus: ",-1)),t("td",null,p(s(a).description),1)]),e[19]||(e[19]=t("tr",null,[t("td",null," Kuvat tehtävästä: "),t("td")],-1)),t("tr",null,[e[17]||(e[17]=t("td",null," Etäisyys ",-1)),t("td",null,p(A.value),1)]),t("tr",null,[e[18]||(e[18]=t("td",null," Matkan aikaa: ",-1)),t("td",null,p(c.value),1)]),e[20]||(e[20]=t("tr",null,[t("td",null,"Sijainti"),t("td",null,[t("div",{id:"map-container"},[t("div",{id:"client-location"}),t("div",{id:"spinner",class:"spinner-overlay"},[t("div",{class:"spinner"})])])])],-1)),e[21]||(e[21]=t("tr",null,[t("td"),t("td")],-1))])]),_:1}),t("div",Se,[f(s(j),{disabled:B.isDisabled,color:"primary",class:"mb-3",onClick:q},{default:v(()=>[f(s(Ie),{size:"2x"},{default:v(()=>[...e[22]||(e[22]=[t("i",{class:"far fa-comment"},null,-1)])]),_:1})]),_:1},8,["disabled"])]),s(a).isIncludeOffers?(d(),y("div",Ue,[s(a).offers.some(i=>i.bookingID===s(a).id)?V("",!0):(d(),y("div",Fe,[f(s(j),{disabled:B.isDisabled,class:"mb-3",block:"",color:"primary",size:"lg",onClick:e[2]||(e[2]=i=>X(r.booking))},{default:v(()=>[...e[23]||(e[23]=[g(" Tee Hintatarjous ",-1)])]),_:1},8,["disabled"]),f(fe,{name:"fade-slide",onBeforeEnter:P,onEnter:P,onAfterEnter:E,onBeforeLeave:P,onLeave:P,onAfterLeave:E},{default:v(()=>[Te(t("div",He,[t("div",Ke,[t("div",Ge,[t("div",qe,[f(s(_),{white:"",onClick:e[3]||(e[3]=i=>N.value=!1)})]),t("form",Je,[f(s($e),{type:"number",label:"Tarjoa hintasi",modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=i=>w.value=i),wrapperClass:"mb-4"},null,8,["modelValue"]),t("div",Qe,[f(s(ue),{label:"Tarjoan palvelu asiakkaan luona",name:"area",modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=i=>h.value=i),value:"go"},null,8,["modelValue"]),f(s(ue),{label:"Tarjoan palvelua paikalla",name:"area",modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=i=>h.value=i),value:"here"},null,8,["modelValue"])]),f(s(de),{style:{},label:"Anna tarvittaessa lisäselvityksiä...",rows:"3",modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=i=>D.value=i)},null,8,["modelValue"]),w.value?(d(),R(s(j),{key:0,disabled:B.isDisabled,label:"Anna hintatarjous",block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:U},{default:v(()=>[...e[24]||(e[24]=[g(" Lähetä ",-1)])]),_:1},8,["disabled"])):V("",!0)])])])],512),[[Ae,N.value]])]),_:1}),e[26]||(e[26]=t("div",null,null,-1)),N.value?V("",!0):(d(),R(s(j),{key:0,disabled:B.isDisabled,block:"",outline:"danger",onClick:J},{default:v(()=>[...e[25]||(e[25]=[g(" Poista tilaus ",-1)])]),_:1},8,["disabled"]))]))])):(d(),y("div",_e,[T.value?V("",!0):(d(),R(s(j),{key:0,disabled:r.isDisableProNotMapBtns,block:"",outline:"success",size:"lg",onClick:e[8]||(e[8]=i=>le())},{default:v(()=>[...e[27]||(e[27]=[g(" Varmista tilaus ",-1)])]),_:1},8,["disabled"])),f(fe,{name:"fade-slide",onBeforeEnter:P,onEnter:P,onAfterEnter:E,onBeforeLeave:P,onLeave:P,onAfterLeave:E},{default:v(()=>[T.value?(d(),y("div",We,[t("div",Ye,[f(s(_),{white:"",onClick:te})]),f(s(de),{style:{},label:"Anna syy...",rows:"3",modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=i=>C.value=i)},null,8,["modelValue"]),f(s(j),{disabled:C.value.length<3,block:"",size:"lg",color:"success",style:{"margin-top":"12px"},onClick:ee},{default:v(()=>[...e[28]||(e[28]=[g(" Varmista ",-1)])]),_:1},8,["disabled"])])):V("",!0)]),_:1}),T.value?V("",!0):(d(),R(s(j),{key:1,block:"",outline:"danger",size:"lg",onClick:Z},{default:v(()=>[...e[29]||(e[29]=[g(" Poista tilaus ",-1)])]),_:1}))]))]))]))}}),me=pe(Xe,[["__scopeId","data-v-8cf0f46d"]]),Ze={style:{"padding-top":"17px"}},et={style:{float:"right",padding:"10px"}},tt={key:0},lt={class:"line"},ot={class:"left-item"},at={key:0,class:"right-item"},st=["onClick"],nt={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},it={key:0,style:{"padding-top":"33px"}},rt={style:{color:"red"}},ut={key:1,class:"booking-row-seen"},dt={class:"line"},ft={class:"left-item"},vt={key:0,class:"right-item"},ct=["onClick"],mt={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},pt={key:0,style:{"padding-top":"33px"}},yt={style:{color:"red"}},gt={key:1},kt=Object.assign({name:"client-offers-list"},{__name:"ClientOffersList",props:{isPro:{type:Boolean},provider:{type:Object},offersIn:{type:Array,default:()=>[]},credit:{type:Number}},emits:["confirm-order-toast"],setup(B,{emit:W}){ke();const H=B,Y=W,{offersIn:a,isPro:Oe,credit:K}=ye(H),G=Me(),b=u(23),x=ge(),{incomingOffers:z,providerId:P}=se(x),E=u({}),M=u(!1),A=u(!1);u(!1);const c=u(!1),N=u(!1),S=u(null),I=u(0),k=u(0),w=u(!1),h=u(""),D=be(()=>Array.isArray(z.value)?z.value:[]),C=u(null);function T(n){C.value=n?.$el??n??null}let $=0,L=0;function q(){const n=C.value;!c.value||!n||($&&cancelAnimationFrame($),L&&cancelAnimationFrame(L),$=requestAnimationFrame(()=>{L=requestAnimationFrame(()=>{const l=C.value;!l||!c.value||(l.style.height=l.scrollHeight+"px")})}))}function X(){$&&cancelAnimationFrame($),L&&cancelAnimationFrame(L),C.value&&requestAnimationFrame(()=>{const l=C.value;l&&(l.style.height="")})}ce("resizeParent",q),ce("unlockParent",X);let U;Ce(()=>{"ResizeObserver"in window&&(U=new ResizeObserver(()=>q()),C.value&&U.observe(C.value))}),je(()=>{U&&U.disconnect()});const Z=()=>{console.log("JUST TEST"),Y("confirm-order-toast"),w.value=!0,h.value="Olet vahvistanut tilauksen!"},ee=()=>{console.log("Parent received confirmed-order-toast"),console.log("EMIT in list"),w.value=!0,h.value="Olet vahvistanut tilauksen!"};function te(n){const[l,o]=n.split(", "),[O,m,oe]=l.split("/").map(Number),[F,Q]=o.split(":").map(Number);return new Date(oe,m-1,O,F,Q)}const le=async(n,l)=>{await ie.addVisitor(n,l),console.log("VISITOR id is "+l.visitor),x.addVisitorForBooking(n,l)},J=async(n,l)=>{if(console.log("Credit "+K.value),k.value=l,K.value>0){console.log("Opening page..."),console.log("Header - "+E.value.header),I.value=n.id,c.value=!c.value,E.value=x.getIncomOfferById(n.id),console.log("Client - [object Object]"),console.log("Here header: "+z.value[0].header),le(n.id,{visitor:H.provider.id});const o=te(n.date);console.log("T.A - "+i(o))}else A.value=!0,M.value=!0,setTimeout(()=>{M.value=!1},2e3)},r=()=>{G.go(-1)},e=()=>{G.push("pay-plan")},i=n=>{let l=Date.now()-new Date(n).getTime();l=Math.max(0,l);const o=Math.floor(l/6e4);if(o<60)return`${o} minuuttia sitten`;const O=Math.floor(o/60);return O<24?`${O} tuntia sitten`:`${Math.floor(O/24)} päivää sitten`};return(n,l)=>(d(),R(s(Be),null,{default:v(()=>[t("div",Ze,[f(s(ne),{modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=o=>A.value=o),autohide:"",delay:1e4,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:v(()=>[...l[8]||(l[8]=[g("PROKEIKKATORI",-1)])]),small:v(()=>[...l[9]||(l[9]=[])]),default:v(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:l[0]||(l[0]=(...o)=>n.hideError&&n.hideError(...o))}),l[11]||(l[11]=g(" Luotto on vanhentunut, et voi enää toimia! ",-1)),t("div",et,[f(s(j),{color:"danger",onClick:e},{default:v(()=>[...l[10]||(l[10]=[g("Lisää luottoa",-1)])]),_:1})])]),_:1},8,["modelValue"]),D.value.length?(d(),y("div",tt,[(d(!0),y(Ne,null,De(D.value,(o,O)=>(d(),y("div",{key:O},[o.visitors.some(m=>m===s(P))?(d(),y("div",ut,[t("div",dt,[t("span",ft,p(i(o.started)),1),c.value&&o.id===I.value?(d(),y("span",vt,[f(s(_),{style:{color:"red"},white:"",onClick:l[4]||(l[4]=m=>c.value=!c.value)})])):V("",!0)]),t("span",{class:ae({"strong-tilt-move-shake":M.value&&O===k.value})},[t("span",{class:"seen_notification",onClick:m=>J(o,O)},[t("b",null,p(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[14]||(l[14]=t("br",null,null,-1)),g(" "+p(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",mt,p(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,ct)],2),o?.disabled?(d(),y("div",pt,[t("p",yt,[g(p(`${o.user.firstName} on poistanut tilauksen!`),1),l[15]||(l[15]=t("strong",{style:{color:"blue"}},"Gooooo",-1))]),l[16]||(l[16]=t("p",null,"hhh",-1))])):V("",!0),o.id===I.value?(d(),R(s(ve),{key:1,id:"collapsibleContent2",ref_for:!0,ref:T,modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=m=>c.value=m)},{default:v(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:S,class:"card-body mt-3"},[f(me,{open:N.value,onResizeParent:n.syncParentHeight,onUnlockParent:n.unlockParentHeight,onConfirmedOrderToast:ee,"is-disabled":o?.disabled,onJustTest:Z,client:E.value},null,8,["open","onResizeParent","onUnlockParent","is-disabled","client"])],512)]),_:2},1032,["modelValue"])):V("",!0)])):(d(),y("div",{key:0,class:ae(["booking-row-new",[{activePanel:o.id===I.value}]])},[t("div",lt,[t("span",ot,p(i(o.started)),1),c.value&&o.id===I.value?(d(),y("span",at,[f(s(_),{white:"",onClick:l[2]||(l[2]=m=>c.value=!c.value)})])):V("",!0)]),t("span",{class:ae({"strong-tilt-move-shake":M.value&&O===k.value})},[t("span",{class:"new_notification",onClick:m=>J(o,O)},[t("b",null,p(o.user.username.length<b.value?o.user.username:o.user.username.substr(0,b.value)+"..."),1),l[12]||(l[12]=t("br",null,null,-1)),g(" "+p(o.header.length<b.value?o.header:o.header.substr(0,b.value)+"...")+" ",1),t("span",nt,p(o.isIncludeOffers?o.offers.some(m=>m.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,st)],2),o?.disabled?(d(),y("div",it,[t("p",rt,[g(p(`${o.user.firstName} on poistanut tilauksen!`),1),l[13]||(l[13]=t("strong",null,"Go",-1))])])):V("",!0),o.id===I.value?(d(),R(s(ve),{key:1,id:"collapsibleContent1",ref_for:!0,ref:T,modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=m=>c.value=m)},{default:v(()=>[t("div",{ref_for:!0,ref_key:"collapseEl",ref:S,class:"card-body mt-3"},[f(me,{open:N.value,onResizeParent:n.syncParentHeight,onUnlockParent:n.unlockParentHeight,"is-disabled":o?.disabled,client:E.value},null,8,["open","onResizeParent","onUnlockParent","is-disabled","client"])],512)]),_:2},1032,["modelValue"])):V("",!0)],2))]))),128))])):(d(),y("div",gt,[f(s(ne),{stacking:!1,autohide:"",delay:3e3,modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=o=>w.value=o),position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:v(()=>[...l[17]||(l[17]=[g(" PROKEIKKATORI ",-1)])]),default:v(()=>[t("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:l[6]||(l[6]=(...o)=>n.hideError&&n.hideError(...o))}),g(" "+p(h.value),1)]),_:1},8,["modelValue"]),t("p",{style:{"text-align":"right",color:"forestgreen","padding-bottom":"50px"},onClick:r},"Poistu"),l[18]||(l[18]=t("h2",null,"Ei tarjouksia!",-1))]))])]),_:1}))}}),ht=pe(kt,[["__scopeId","data-v-cdae3b5b"]]);export{ht as default};
