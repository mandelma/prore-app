import{_ as oe,C as Z,x as _,i as F,o as C,w as f,g as a,b as v,y,c as E,z as U,e as d,v as ae,I as xe,m as W,h as q,J as Ce,r as s,N as Me,k as Le,a as De,O as ee,D as qe,n as te,Q as Ie,A as R,E as Se,L as Ve,M as Pe,P as Te,q as Oe,l as Ee,R as Ne,S as $e,t as Fe,V as _e,W as He,Y as ze}from"./index-G9ZV8JxE.js";import{o as Ae,s as Be}from"./index-DdFdx48A.js";import{l as Re}from"./loadGoogleMap-DZ-zVA3K.js";import"./index-93e-Jyro.js";const Ue=(I,w)=>{const u=new Date(I);return new Date(w)>=u},je=(I,w,u)=>{const k=new Date(w),p=new Date(u);return I>=k&&I<p},Ge={compare:Ue,providerMatchingForClient:je},Ke={style:{"background-color":"#0b1618",padding:"17px",border:"1px solid #1B2330","border-radius":"8px"}},We={class:"field-wrapper"},Je={class:"field-wrapper"},Ye={class:"field-wrapper"},Qe={key:0,class:"field-footer"},Xe={style:{"margin-top":"17px"},class:"field-wrapper"},Ze={key:0,class:"field-footer"},et={class:"message-counter"},tt=Object.assign({name:"request-form"},{__name:"RequestForm",props:{target:{type:null},date:String},emits:["sendRequest"],setup(I,{emit:w}){const u=I,k=w,p=Z({requestHeader:"",requestContent:""}),b=Z({}),D=()=>(b.requestHeader=p.requestHeader?"":"Header is required",b.requestContent=p.requestContent?"":"Kuvaus is required",!b.requestHeader&&!b.requestContent);_(()=>p.requestHeader,()=>b.requestHeader=""),_(()=>p.requestContent,()=>b.requestContent="");const P=r=>r instanceof Date&&!isNaN(+r),H=r=>{if(!r)return null;if(r instanceof Date)return P(r)?r:null;if(typeof r=="string"){const c=new Date(r.includes("T")?r:r.replace(",","").replace(" ","T"));if(P(c))return c;let x=r.match(/^(\d{4})-(\d{2})-(\d{2})[,\s]+(\d{2}):(\d{2})(?::(\d{2}))?$/);if(x){const[,S,g,V,M,T,N]=x.map(Number);return new Date(S,g-1,V,M,T,N||0)}if(x=r.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})(?::(\d{2}))?$/),x){const[,S,g,V,M,T,N]=x.map(Number);return new Date(V,g-1,S,M,T,N||0)}}return null},j=r=>{const c=H(r);return P(c)?new Intl.DateTimeFormat("fi-FI",{dateStyle:"long",timeStyle:"short",timeZone:"Europe/Helsinki",hour12:!1,hourCycle:"h23"}).format(c):""},z=()=>{D()?(console.log("Validated"),k("sendRequest",{header:p.requestHeader,content:p.requestContent})):console.log("No validated")};return(r,c)=>(C(),F(d(Ce),null,{default:f(()=>[a("form",Ke,[a("div",We,[a("p",null,y(u.target?.address),1)]),a("div",Je,[a("p",null,y(j(u.date)),1)]),a("div",Ye,[v(d(ae),{label:"Syötä tilauksen avainsana *",modelValue:p.requestHeader,"onUpdate:modelValue":c[0]||(c[0]=x=>p.requestHeader=x),size:"lg",invalidFeedback:"Ole hyvä ja kirjoita avainsana.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),b.requestHeader?(C(),E("span",Qe,y(b.requestHeader),1)):U("",!0),a("div",Xe,[v(d(xe),{maxlength:"70",label:"Kuvaus tilauksen sisällöstä *",rows:"3",modelValue:p.requestContent,"onUpdate:modelValue":c[1]||(c[1]=x=>p.requestContent=x),invalidFeedback:"Ole hyvä ja kirjoita tehtävän kuvaus.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),b.requestContent?(C(),E("span",Ze,y(b.requestContent),1)):U("",!0),a("span",et,y(p.requestContent.length)+" / 70",1)])]),v(d(W),{color:"primary",onClick:z},{default:f(()=>[...c[2]||(c[2]=[q("Kinnita",-1)])]),_:1})])]),_:1}))}}),ot=oe(tt,[["__scopeId","data-v-de75f0dd"]]),at={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},lt={key:0,class:"client-map-panel"},nt={style:{display:"flex","justify-content":"right"}},st={class:"input-group"},it={class:"field-wrapper"},rt={key:0},dt={key:1},ut={class:"flex items-center gap-2"},ct={class:"distSelectPanel"},mt={class:"field-wrapper"},pt={style:{"margin-top":"15px"}},gt={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},vt={style:{padding:"13px 0 20px 0"}},ft=Object.assign({name:"pro-around"},{__name:"ProAround",setup(I){const w=s(null),u=s(null),k=s(null),p=s(!1),b=Ae,D=s(""),P=s(!1),H=s(!1),j=s(""),z=s(!1),r=s(null);s(0),s(!1);const c=s(!0),x=s(null),S=s(0),g=s(null),V=s(null),M=s(null),T=Ge,N=s(0),A=s(!1),B=s(!1),G=s(null),J=s(!1),le=s(""),ne=Me(),Y=Le(),se=De(),{user:ie}=ee(Y),{providerId:re}=ee(se),de=s([{text:"1 km",value:1},{text:"10 km",value:10},{text:"20 km",value:20},{text:"30 km",value:30},{text:"40 km",value:40},{text:"50 km",value:50},{text:"60 km",value:60},{text:"70 km",value:70},{text:"80 km",value:80},{text:"90 km",value:90},{text:"100 km",value:100},{text:"200 km",value:200},{text:"300 km",value:300}]);_(H,t=>{t&&(console.log("Ready? "+t),_(r,e=>{console.log("Dist is changed ",e),ye(D.value.label,e)},{immediate:!0}))}),_(A,t=>{if(t){g.value=ce(new Date),S.value++;const o=new Date().toLocaleString("fi-FI",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",","");V.value=o}else g.value=null,V.value=null,S.value++});const ue=()=>{console.log("Changed "+D.value.label),j.value=D.value.label,z.value=!0};function ce(t=new Date){const e=n=>String(n).padStart(2,"0"),l=t.getFullYear(),o=e(t.getMonth()+1),i=e(t.getDate()),m=e(t.getHours()),L=e(t.getMinutes());return`${l}-${o}-${i}, ${m}:${L}`}const me=async()=>{try{await Re(),console.log("Map is inited in pro around! ✅"),pe();const t=document.getElementById("client-input"),e={lat:50.064192,lng:-130.605469},o={bounds:{north:e.lat+.1,south:e.lat-.1,east:e.lng+.1,west:e.lng-.1},componentRestrictions:{country:"fi"},fields:["address_components","geometry","icon","name","formatted_address"],strictBounds:!1},i=new google.maps.places.Autocomplete(t,o);i.addListener("place_changed",()=>{let m=i.getPlace();u.value=m.geometry.location.lat(),k.value=m.geometry.location.lng(),console.log("Address xxxx "+m.formatted_address),console.log("place-----lat------"+u.value)});try{new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(u.value,k.value),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50})}catch(m){console.log("Error to load map: "+m.message)}}catch(t){console.error("Google Maps failed to load ❌",t),p.value=!0}},pe=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{const{latitude:e,longitude:l}=t.coords;u.value=e,k.value=l,console.log("myLat "+e),ge(e,l)})},ge=(t,e)=>{try{console.log("Map is loading...");const l=document.getElementById("map");if(!l)throw new Error("Map container #map not found");if(!(l instanceof HTMLElement))throw new Error("Map container is not an HTMLElement");const o=new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50}),i=document.getElementById("spinner");google.maps.event.addListenerOnce(o,"tilesloaded",()=>{console.log("tiles loaded"),i.style.opacity="0",setTimeout(()=>i.style.display="none",400),H.value=!0})}catch(l){console.log("Error to load map: "+l.message)}ve(t,e)},ve=(t,e)=>{Fe.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&key=AIzaSyDt2YXE5tk0J72JgqnH3DTD7MeoqbbWBmU").then(l=>{l.data.error_message?console.log(l.data.error_message):(new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP}),w.value=l.data.results[1].formatted_address)}).catch(l=>{console.log(l.message)})},Q=(t,e,l,o)=>{var i=new google.maps.LatLng(t,e),m=new google.maps.LatLng(l,o);return(google.maps.geometry.spherical.computeDistanceBetween(i,m)/1e3).toFixed(2)},fe=async(t,e,l)=>{if(!window.google||!window.google.maps){console.error("Google Maps not loaded yet");return}console.log("Profession and dist... "+e+" "+l),console.log("lat - "+u.value);let o=!1,i=new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(u.value,k.value),mapTypeId:google.maps.MapTypeId.ROADMAP});console.log("Users count: "+t.length),console.log("Current distance "+l);let m;g.value&&(console.log("Booking date 2 "+new Date(g.value)),m=new Date(g.value));let L=0;if(t.length>0){for(let n=0;n<t.length;n++)console.log("-----Firma------- "+t[n].pName),u.value,k.value,t[n].profession.forEach(X=>{if(X===e&&(console.log("Pro "+X),t[n].latitude,t[n].longitude,console.log("Distance btw "+Q(u.value,k.value,t[n].latitude,t[n].longitude)),Q(u.value,k.value,t[n].latitude,t[n].longitude)<=l)){L++;let O;t[n].isAvailable24_7?O=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].yritys,icon:this.pinSymbol("seagreen","darkgreen"),label:{color:"green",fontWeight:"bold",fontSize:"14px"}}):t[n].timetable.length>0?t[n].timetable.map(h=>{console.log("Date: "+h.start),console.log("Fitting datetime: "+T.providerMatchingForClient(m,h.start,h.end)),T.providerMatchingForClient(m,h.start,h.end)||t[n].isAvailable24_7?O=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("seagreen","darkgreen")}):O=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("orange","darkorange")})}):O=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("orange","darkorange")}),window.myGlobalFunction=this&&this.openMarker?this.openMarker.bind(this):h=>we(t[h]);const $=new google.maps.InfoWindow;$.addListener("domready",()=>{const h=document.querySelector(".gm-ui-hover-effect");h&&(h.style.display="none"),document.getElementById("custom-close")?.addEventListener("click",()=>$.close())}),O.addListener("click",()=>{console.log("POOOOS",n);const h=n;o&&o.close(),o=$,$.setContent(`
                <div class="custom-info">
                  <div style="display: flex; justify-content: right;">
                    <button id="custom-close">×</button>
                  </div>
                  
                  <h3>My Place</h3>
                  <p>Hello world!</p>
                  <div>
                  <p style="color: green;">${t[h].pName}</p>
                  <p style="color: red;" onclick="myGlobalFunction(${h})">Tiedot</p>
                </div>
                </div>
                `),$.open({anchor:O,map:i,shouldFocus:!1})})}});N.value=L,L>0?(console.log("Pro count existing..."),c.value=!1):console.log("Pro count not existing..."),x.value=L,console.log("countxx "+L)}},ye=async(t,e)=>{console.log("Current distance herexx  ");const l=await ze.getProviders();l&&fe(l,t,e)},we=t=>{console.log("Ordered company: "+t.pName),M.value=t,G.value=t,B.value=!0},ke=t=>{const e=t?.match(/^(\d{2})\/(\d{2})\/(\d{4}),?\s+(\d{2}):(\d{2})$/);if(!e)return null;const[,l,o,i,m,L]=e.map(Number);return new Date(i,o-1,l,m,L)},he=async t=>{const e=await Y.user.id,l=M.value.user.id;console.log("Sending request to "+M.value.user.username);const o=ke(g.value);let i;o?(i=o.getTime(),console.log("Milliseconds:",i)):console.log("Invalid date string");const m={author_id:e,created:o,created_ms:i,dateStr:g.value,header:t.header,agreement:!1,address:w.value,latitude:u.value,longitude:k.value,zone:0,professional:D.value.label,isIncludeOffers:!1,description:t.content,status:"pending"};B.value=!1,ne.onRequest(l,e,M.value,ie.value,m)};qe(async()=>{await me()});const be=()=>{P.value=!1,w.value=""},K=(t,e)=>{const l=document.createElement("div");return l.className="price-tag",l.textContent="$2.5M",{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:t,fillOpacity:1,strokeColor:e,strokeWeight:2,scale:1,labelOrigin:{x:60,y:-25}}};return(t,e)=>{const l=Oe("HandleToast");return C(),E($e,null,[a("div",null,[a("div",at,[c.value?(C(),E("div",lt,[a("div",nt,[v(d(te),{size:"lg",style:{padding:"10px"},onClick:e[0]||(e[0]=o=>c.value=!1)},{default:f(()=>[...e[13]||(e[13]=[a("i",{class:"fas fa-expand-arrows-alt"},null,-1)])]),_:1}),a("div",null,[v(d(Ie),{white:"",style:{padding:"10px"},size:"sm",onClick:e[1]||(e[1]=o=>t.$router.go(-1))})])]),a("div",{class:R([{hideClientInput:!w.value&&P.value},"field-wrapper"]),style:{width:"100%"}},[a("div",st,[v(d(ae),{size:"sm",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=o=>w.value=o),label:"Anna osoite",id:"client-input",placeholder:"",wrapperClass:"form-outline flex-grow-3",inputClass:"ps-0","aria-describedby":"button-addon2"},null,8,["modelValue"]),w.value?(C(),F(d(W),{key:0,type:"button",style:{border:"1px solid #ddd"}},{default:f(()=>[v(d(te),{size:"1x",onClick:e[3]||(e[3]=o=>be())},{default:f(()=>[...e[14]||(e[14]=[a("i",{class:R("fas fa-times")},null,-1)])]),_:1})]),_:1})):U("",!0)])],2),a("div",it,[a("div",null,[v(d(Be),{style:Se([{width:"100%"},t.isNoPro?"color: pink; border: 1px solid red;":"color: white;"]),modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=o=>D.value=o),onChange:ue,options:d(b),filter:"",optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Valitse ammattilainen *",class:"w-full md:w-[30rem]"},{value:f(o=>[o.value?(C(),E("div",rt,[a("div",null,y(o.value.label),1)])):(C(),E("span",dt,y(o.placeholder),1))]),optiongroup:f(o=>[a("div",ut,[a("i",{class:R(o.option.icon),style:{"font-size":"17px",color:"cadetblue"}},null,2),e[15]||(e[15]=q("    ",-1)),a("span",null,y(o.option.label),1)])]),_:1},8,["modelValue","options","style"])])]),a("div",{class:R({hideDistSelectPanel:!z.value})},[e[16]||(e[16]=a("p",{style:{"text-align":"left"}},"Valitse kiinnostavaa ajankohta tai heti!",-1)),a("div",ct,[a("div",mt,[(C(),F(d(Ve),{size:"lg",label:"Valitse tehtävän päivämäärä ja aika",modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),toggleButton:!1,inputToggle:"",datepicker:{...t.L},timepicker:{...t.L,hoursFormat:24},key:S.value,disablePast:""},null,8,["modelValue","datepicker","timepicker"]))]),q(" isDateNow "+y(A.value)+" date "+y(V.value)+" ",1),a("div",pt,[v(d(Pe),{label:"Heti!",name:"selection",modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=o=>A.value=o),value:"true",onClick:t.removeDateIfExist,wrapperClass:"mb-4"},null,8,["modelValue","onClick"])]),q(" dt "+y(g.value),1)])],2),v(d(Te),{size:"sm",white:"",selected:r.value,"onUpdate:selected":e[7]||(e[7]=o=>r.value=o),options:de.value,label:"Etsi alue",id:"distance"},null,8,["selected","options"])])):(C(),F(d(W),{key:1,color:"primary",style:{position:"absolute",opacity:"0.8",top:"60px",left:"80%","z-index":"2"},onClick:e[8]||(e[8]=o=>c.value=!0)},{default:f(()=>[...e[17]||(e[17]=[q(" Paneeli ",-1)])]),_:1}))]),e[20]||(e[20]=q(" /* ",-1)),a("div",gt,[v(l,{modelValue:t.toastModel,"onUpdate:modelValue":e[9]||(e[9]=o=>t.toastModel=o),"toast-name":t.toastState,"icon-state":t.toastIcon,text:t.toastContent},null,8,["modelValue","toast-name","icon-state","text"])]),e[21]||(e[21]=q(" */ ",-1)),a("div",vt,[v(d(Ee),{modelValue:J.value,"onUpdate:modelValue":e[11]||(e[11]=o=>J.value=o),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:f(()=>[...e[18]||(e[18]=[q("PROKEIKKATORI",-1)])]),small:f(()=>[...e[19]||(e[19]=[])]),default:f(()=>[a("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[10]||(e[10]=(...o)=>t.hideError&&t.hideError(...o))}),a("p",null,y(le.value),1)]),_:1},8,["modelValue"])]),a("div",null,[v(d(Ne),{tabindex:"-1",centered:"",modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=o=>B.value=o)},{default:f(()=>[v(d(_e),null,{default:f(()=>[a("h2",null,y(G.value.pName),1)]),_:1}),v(d(He),null,{default:f(()=>[a("p",null,"Tällä - "+y(G.value.pName)+" - tiedot...",1),M.value.id!==d(re)?(C(),F(ot,{key:0,target:M.value,date:g.value,onSendRequest:he},null,8,["target","date"])):U("",!0)]),_:1})]),_:1},8,["modelValue"])])]),e[22]||(e[22]=a("div",{id:"map-container"},[a("div",{id:"map"}),a("div",{id:"spinner",class:"spinner-overlay"},[a("div",{class:"spinner"})])],-1))],64)}}}),bt=oe(ft,[["__scopeId","data-v-346113f9"]]);export{bt as default};
