import{aY as ge,k as Pe,aZ as we,a_ as Ie,a as ke,P as be,a$ as de,r,Q as _,B as Ce,D as he,b0 as Ee,c,o as i,g as l,b as u,w as d,h as p,e as s,l as ie,T as Te,y as C,x as m,b1 as $e,n as Ae,m as T,i as M,F as je,R as q,v as Be,a8 as ve,I as fe,H as Me,aV as ce,K as re,a0 as Ne,J as De,f as Re,N as xe,O as Le,z as ne,b2 as me,b3 as pe}from"./index-DW7v6QT8.js";import{l as ze}from"./loadGoogleMap-DZ-zVA3K.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-93e-Jyro.js";const Se={style:{padding:"13px 0 20px 0"}},Ue={key:0},Fe={key:1,style:{"border-top":"1px solid grey"}},He={key:0,style:{display:"flex","justify-content":"right"}},Ke={key:1,style:{"margin-bottom":"20px"}},Ge={key:0},_e={class:"card card-body"},qe={class:"mt-3"},Je={style:{padding:"13px","font-size":"14px","margin-bottom":"20px"}},Qe={style:{display:"flex","justify-content":"right","margin-bottom":"13px"}},We={class:"form-card"},Ye={style:{"text-align":"left","margin-bottom":"10px"}},Xe={key:2,style:{"margin-bottom":"20px"}},Ze={key:0,style:{padding:"13px","margin-top":"13px",border:"1px solid grey"},class:"form-card"},et={style:{display:"flex","justify-content":"right","margin-bottom":"7px"}},tt=Object.assign({name:"client-offer"},{__name:"ClientOffer",props:{client:{type:Object,default:()=>({})},open:{type:Boolean,default:!1},isDisabled:{type:Boolean}},emits:["confirmed-order-toast","just-test"],setup($,{emit:J}){const z=$,Q=J,{client:a,open:Ve}=ge(z),U=Pe(),F=we(),V=Ie(),w=ke();be();const N=de("resizeParent"),H=de("unlockParent");function k(){typeof N=="function"&&N()}function I(){typeof H=="function"&&H()}const D=Ee,v=r(null),A=r(null),j=r(!1),{user:P}=_(U),{providerId:R,provider:y}=_(w),{openChat:S}=_(V),E=r(null),g=r("here"),B=r(""),O=r(""),h=r(!1);r(!0);const x=r(!1);r(null),Ce(()=>z.client?.professional?.[0]?.profession||""),he(async()=>{await W()});const W=async()=>{try{await ze(),console.log("Map is inited in ClientOffer! ✅"),console.log("CXC "+await D.findDistance([y.value.latitude,y.value.longitude],[a.value.latitude,a.value.longitude]));const n=await D.findDistance([y.value.latitude,y.value.longitude],[a.value.latitude,a.value.longitude]);n&&(console.log("Distance is "+n.distance),console.log("Duration is "+n.duration),v.value=n.distance,A.value=n.duration);const e=document.getElementById("client-location");if(!e)throw new Error("#client-location not found in DOM");const t=new google.maps.Map(e,{zoom:11,center:new google.maps.LatLng(a.value.latitude,a.value.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP});new google.maps.Marker({position:{lat:a.value.latitude,lng:a.value.longitude},map:t}),google.maps.event.addListenerOnce(t,"idle",()=>{const o=document.getElementById("spinner");o&&(o.style.display="none")})}catch(n){console.error("Google Maps failed to load ❌",n),x.value=!0;const e=document.getElementById("spinner");e&&(e.style.display="none")}},L=async()=>{console.log("Chat btn"),console.log("otheruserId - ",a.value.author_id)},Y=()=>{console.log("Make offer!"),j.value=!0},X=()=>{console.log("Creating offer! "+E.value);const n={bookingID:a.value.id,sender:P.value.id,isNewOffer:!0,name:y.value.pName,placeOrGo:g.value,area:a.value.zone,distance:v?.value,duration:A?.value,price:E.value,description:B.value,place:g.value,provider:R.value};console.log("Client in top: "+{}.value);const e=a.value.author_id;console.log("Addressee - "+e),w.addProviderOffer(a.value.id,e,n)},Z=async()=>{h.value=!0},ee=async()=>{if(confirm("Oletko varmaa että tilaus poistetaan?")){console.log("Quit offer user - "+a.value.author_id),console.log(Object.keys(a.value.user));const n=a.value.id,e=a.value.author_id,t="Tilaus hylätty!",o=`${y.value.pName} ei hyväksynyt lähettämääsi tilausta "${a.value.header}". Syyksi ilmoitettu: ${O.value}!`;console.log("111"),await w.removeMapOffer(n,e),console.log("222"),await F.addNotification(n,y.value.pName,t,o,e)}else console.log("Keskeytetty poistaminen!")},K=()=>{h.value=!1,O.value=""},te=async()=>{console.log("client user id: "+a.value.author_id),console.log("Client user name?? "+a.value.user.firstName),a.value.author_id;const n=P.value.id,e=a.value.id,t="Sopimus tehty!",o=`${y.value.pName} on vahvistanut tilauksen - "${a.value.header}". Tarkemmat tiedot kalenterissa!`,b=`Tilaus "${a.value.header}" on vahvistettu. Tiedot kalenterissa!`,f={bookingID:a.value.id,sender:P.value.id,isNewOffer:!0,name:y.value.pName,placeOrGo:g.value,area:a.value.zone,distance:v?.value,duration:A?.value,price:E.value,description:B.value,place:g.value,provider:R.value},oe={bookingId:e,isNewMsg:!0,isLink:!0,title:t,content:o,reason:"",sender:y.value.pName},ae={bookingId:e,isNewMsg:!0,isLink:!0,title:t,content:b,reason:"",sender:y.value.pName},se={cNote:oe,pNote:ae};console.log("Button clicked in child");try{const G=await re.updateRecipientStatus(e,{status:"confirmed"}),ue=await re.addConfirmedOffer(e,f);if(!G||!ue)return;Q("just-test"),await w.onClientBooking(a.value.id,f,n,a.value.author_id,se),console.log("Child about to emit confirmed-order-toast (TEMP ALWAYS)"),console.log("API results:",{confirmation:G,addConfirmation:ue})}catch(G){console.error("API error in child:",G)}},le=async()=>{if(confirm("Oletko varmaa, että haluat poistaa tilauksen kokonaan?")){h.value=!0,console.log("Reject");const n=a.value.author_id;console.log("RECEIVER - "+n),await w.removeBookingPublicOffer(a.value.id,n)}else console.log("Cancelled")};return(n,e)=>(i(),c("div",null,[l("div",Se,[u(s(ie),{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:d(()=>[...e[10]||(e[10]=[p("VIRHE LOMAKEELLA! ",-1)])]),small:d(()=>[...e[11]||(e[11]=[])]),default:d(()=>[l("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[0]||(e[0]=(...t)=>n.hideError&&n.hideError(...t))}),e[12]||(e[12]=p(" ⚠️ We couldn’t load Google Maps right now. Please check your network connection and try again later. ",-1))]),_:1},8,["modelValue"])]),!s(a).professional&&!n.road?(i(),c("div",Ue,[u(s(Te),{color:"info"})])):(i(),c("div",Fe,[u(s($e),{borderless:"",style:{"font-size":"12px",color:"#dddddd","text-align":"left"}},{default:d(()=>[l("tbody",null,[l("tr",null,[e[13]||(e[13]=l("td",null," Osoite: ",-1)),l("td",null,m(s(a).address),1)]),l("tr",null,[e[14]||(e[14]=l("td",null," Tarvitaan ammattilaista: ",-1)),l("td",null,m(s(a)?.professional?.[0]),1)]),l("tr",null,[e[15]||(e[15]=l("td",null," Ajankohda: ",-1)),l("td",null,m(s(a).date),1)]),l("tr",null,[e[16]||(e[16]=l("td",null," Tehtävän kuvaus: ",-1)),l("td",null,m(s(a).description),1)]),e[19]||(e[19]=l("tr",null,[l("td",null," Kuvat tehtävästä: "),l("td")],-1)),l("tr",null,[e[17]||(e[17]=l("td",null," Etäisyys ",-1)),l("td",null,m(v.value),1)]),l("tr",null,[e[18]||(e[18]=l("td",null," Matkan aikaa: ",-1)),l("td",null,m(A.value),1)]),e[20]||(e[20]=l("tr",null,[l("td",null,"Sijainti"),l("td",null,[l("div",{id:"map-container"},[l("div",{id:"client-location"}),l("div",{id:"spinner",class:"spinner-overlay"},[l("div",{class:"spinner"})])])])],-1)),e[21]||(e[21]=l("tr",null,[l("td"),l("td")],-1))])]),_:1}),s(S)?C("",!0):(i(),c("div",He,[u(s(T),{disabled:$.isDisabled,color:"primary",class:"mb-3",onClick:L},{default:d(()=>[u(s(Ae),{size:"2x"},{default:d(()=>[...e[22]||(e[22]=[l("i",{class:"far fa-comment"},null,-1)])]),_:1})]),_:1},8,["disabled"])])),s(a).isIncludeOffers?(i(),c("div",Ke,[s(a).offers.some(t=>t.bookingID===s(a).id)?C("",!0):(i(),c("div",Ge,[u(s(T),{disabled:$.isDisabled,class:"mb-3",block:"",color:"primary",size:"lg",onClick:e[2]||(e[2]=t=>Y(n.booking))},{default:d(()=>[...e[23]||(e[23]=[p(" Tee Hintatarjous ",-1)])]),_:1},8,["disabled"]),u(ce,{name:"fade-slide",onBeforeEnter:k,onEnter:k,onAfterEnter:I,onBeforeLeave:k,onLeave:k,onAfterLeave:I},{default:d(()=>[je(l("div",_e,[l("div",qe,[l("div",Je,[l("div",Qe,[u(s(q),{white:"",onClick:e[3]||(e[3]=t=>j.value=!1)})]),l("form",We,[u(s(Be),{type:"number",label:"Tarjoa hintasi",modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=t=>E.value=t),wrapperClass:"mb-4"},null,8,["modelValue"]),l("div",Ye,[u(s(ve),{label:"Tarjoan palvelu asiakkaan luona",name:"area",modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),value:"go"},null,8,["modelValue"]),u(s(ve),{label:"Tarjoan palvelua paikalla",name:"area",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),value:"here"},null,8,["modelValue"])]),u(s(fe),{style:{},label:"Anna tarvittaessa lisäselvityksiä...",rows:"3",modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=t=>B.value=t)},null,8,["modelValue"]),E.value?(i(),M(s(T),{key:0,disabled:$.isDisabled,label:"Anna hintatarjous",block:"",size:"lg",outline:"success",style:{"margin-top":"12px"},onClick:X},{default:d(()=>[...e[24]||(e[24]=[p(" Lähetä ",-1)])]),_:1},8,["disabled"])):C("",!0)])])])],512),[[Me,j.value]])]),_:1}),e[26]||(e[26]=l("div",null,null,-1)),j.value?C("",!0):(i(),M(s(T),{key:0,disabled:$.isDisabled,block:"",outline:"danger",onClick:le},{default:d(()=>[...e[25]||(e[25]=[p(" Poista tilaus ",-1)])]),_:1},8,["disabled"]))]))])):(i(),c("div",Xe,[h.value?C("",!0):(i(),M(s(T),{key:0,disabled:n.isDisableProNotMapBtns,block:"",outline:"success",size:"lg",onClick:e[8]||(e[8]=t=>te())},{default:d(()=>[...e[27]||(e[27]=[p(" Varmista tilaus ",-1)])]),_:1},8,["disabled"])),u(ce,{name:"fade-slide",onBeforeEnter:k,onEnter:k,onAfterEnter:I,onBeforeLeave:k,onLeave:k,onAfterLeave:I},{default:d(()=>[h.value?(i(),c("div",Ze,[l("div",et,[u(s(q),{white:"",onClick:K})]),u(s(fe),{style:{},label:"Anna syy...",rows:"3",modelValue:O.value,"onUpdate:modelValue":e[9]||(e[9]=t=>O.value=t)},null,8,["modelValue"]),u(s(T),{disabled:O.value.length<3,block:"",size:"lg",color:"success",style:{"margin-top":"12px"},onClick:ee},{default:d(()=>[...e[28]||(e[28]=[p(" Varmista ",-1)])]),_:1},8,["disabled"])])):C("",!0)]),_:1}),h.value?C("",!0):(i(),M(s(T),{key:1,block:"",outline:"danger",size:"lg",onClick:Z},{default:d(()=>[...e[29]||(e[29]=[p(" Poista tilaus ",-1)])]),_:1}))]))]))]))}}),ye=Oe(tt,[["__scopeId","data-v-0b96adae"]]),lt={style:{"padding-top":"17px"}},ot={style:{float:"right",padding:"10px"}},at={key:0},st={class:"line"},nt={class:"left-item"},it={key:0,class:"right-item"},rt=["onClick"],ut={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},dt={key:0,style:{"padding-top":"33px"}},vt={style:{color:"red"}},ft={key:1,class:"booking-row-seen"},ct={class:"line"},mt={class:"left-item"},pt={key:0,class:"right-item"},yt=["onClick"],gt={style:{display:"flex","justify-content":"right",color:"deepskyblue",cursor:"pointer"}},kt={key:0,style:{"padding-top":"33px"}},bt={style:{color:"red"}},Ct={key:1},ht=Object.assign({name:"client-offers-list"},{__name:"ClientOffersList",props:{isPro:{type:Boolean},provider:{type:Object},offersIn:{type:Array,default:()=>[]},credit:{type:Number}},emits:["confirm-order-toast"],setup($,{emit:J}){be();const z=$,Q=J,{offersIn:a,isPro:Ve,credit:U}=ge(z),F=Re(),V=r(23),w=ke(),{incomingOffers:N,providerId:H}=_(w),k=r({}),I=r(!1),D=r(!1);r(!1);const v=r(!1),A=r(!1),j=r(null),P=r(0),R=r(0),y=r(!1),S=r(""),E=Ce(()=>Array.isArray(N.value)?N.value:[]),g=r(null);function B(e){g.value=e?.$el??e??null}let O=0,h=0;function x(){const e=g.value;!v.value||!e||(O&&cancelAnimationFrame(O),h&&cancelAnimationFrame(h),O=requestAnimationFrame(()=>{h=requestAnimationFrame(()=>{const t=g.value;!t||!v.value||(t.style.height=t.scrollHeight+"px")})}))}function W(){O&&cancelAnimationFrame(O),h&&cancelAnimationFrame(h),g.value&&requestAnimationFrame(()=>{const t=g.value;t&&(t.style.height="")})}pe("resizeParent",x),pe("unlockParent",W);let L;he(()=>{"ResizeObserver"in window&&(L=new ResizeObserver(()=>x()),g.value&&L.observe(g.value))}),Ne(()=>{L&&L.disconnect()});const Y=()=>{console.log("JUST TEST"),Q("confirm-order-toast"),y.value=!0,S.value="Olet vahvistanut tilauksen!"},X=()=>{console.log("Parent received confirmed-order-toast"),console.log("EMIT in list"),y.value=!0,S.value="Olet vahvistanut tilauksen!"};function Z(e){const[t,o]=e.split(", "),[b,f,oe]=t.split("/").map(Number),[ae,se]=o.split(":").map(Number);return new Date(oe,f-1,b,ae,se)}const ee=async(e,t)=>{await re.addVisitor(e,t),console.log("VISITOR id is "+t.visitor),w.addVisitorForBooking(e,t)},K=async(e,t)=>{if(console.log("Credit "+U.value),R.value=t,U.value>0){console.log("Opening page..."),console.log("Header - "+k.value.header),P.value=e.id,v.value=!v.value,k.value=w.getIncomOfferById(e.id),console.log("Client - [object Object]"),console.log("Here header: "+N.value[0].header),ee(e.id,{visitor:z.provider.id});const o=Z(e.date);console.log("T.A - "+n(o))}else D.value=!0,I.value=!0,setTimeout(()=>{I.value=!1},2e3)},te=()=>{F.go(-1)},le=()=>{F.push("pay-plan")},n=e=>{let t=Date.now()-new Date(e).getTime();t=Math.max(0,t);const o=Math.floor(t/6e4);if(o<60)return`${o} minuuttia sitten`;const b=Math.floor(o/60);return b<24?`${b} tuntia sitten`:`${Math.floor(b/24)} päivää sitten`};return(e,t)=>(i(),M(s(De),null,{default:d(()=>[l("div",lt,[u(s(ie),{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=o=>D.value=o),autohide:"",delay:1e4,stacking:!1,position:"top-center",toast:"danger",icon:"fas fa-exclamation-circle fa-lg me-2"},{title:d(()=>[...t[8]||(t[8]=[p("PROKEIKKATORI",-1)])]),small:d(()=>[...t[9]||(t[9]=[])]),default:d(()=>[l("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:t[0]||(t[0]=(...o)=>e.hideError&&e.hideError(...o))}),t[11]||(t[11]=p(" Luotto on vanhentunut, et voi enää toimia! ",-1)),l("div",ot,[u(s(T),{color:"danger",onClick:le},{default:d(()=>[...t[10]||(t[10]=[p("Lisää luottoa",-1)])]),_:1})])]),_:1},8,["modelValue"]),E.value.length?(i(),c("div",at,[(i(!0),c(xe,null,Le(E.value,(o,b)=>(i(),c("div",{key:b},[o.visitors.some(f=>f===s(H))?(i(),c("div",ft,[l("div",ct,[l("span",mt,m(n(o.started)),1),v.value&&o.id===P.value?(i(),c("span",pt,[u(s(q),{style:{color:"red"},white:"",onClick:t[4]||(t[4]=f=>v.value=!v.value)})])):C("",!0)]),l("span",{class:ne({"strong-tilt-move-shake":I.value&&b===R.value})},[l("span",{class:"seen_notification",onClick:f=>K(o,b)},[l("b",null,m(o.user.username.length<V.value?o.user.username:o.user.username.substr(0,V.value)+"..."),1),t[14]||(t[14]=l("br",null,null,-1)),p(" "+m(o.header.length<V.value?o.header:o.header.substr(0,V.value)+"...")+" ",1),l("span",gt,m(o.isIncludeOffers?o.offers.some(f=>f.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,yt)],2),o?.disabled?(i(),c("div",kt,[l("p",bt,[p(m(`${o.user.firstName} on poistanut tilauksen!`),1),t[15]||(t[15]=l("strong",{style:{color:"blue"}},"Gooooo",-1))]),t[16]||(t[16]=l("p",null,"hhh",-1))])):C("",!0),o.id===P.value?(i(),M(s(me),{key:1,id:"collapsibleContent2",ref_for:!0,ref:B,modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=f=>v.value=f)},{default:d(()=>[l("div",{ref_for:!0,ref_key:"collapseEl",ref:j,class:"card-body mt-3"},[u(ye,{open:A.value,onResizeParent:e.syncParentHeight,onUnlockParent:e.unlockParentHeight,onConfirmedOrderToast:X,"is-disabled":o?.disabled,onJustTest:Y,client:k.value},null,8,["open","onResizeParent","onUnlockParent","is-disabled","client"])],512)]),_:2},1032,["modelValue"])):C("",!0)])):(i(),c("div",{key:0,class:ne(["booking-row-new",[{activePanel:o.id===P.value}]])},[l("div",st,[l("span",nt,m(n(o.started)),1),v.value&&o.id===P.value?(i(),c("span",it,[u(s(q),{white:"",onClick:t[2]||(t[2]=f=>v.value=!v.value)})])):C("",!0)]),l("span",{class:ne({"strong-tilt-move-shake":I.value&&b===R.value})},[l("span",{class:"new_notification",onClick:f=>K(o,b)},[l("b",null,m(o.user.username.length<V.value?o.user.username:o.user.username.substr(0,V.value)+"..."),1),t[12]||(t[12]=l("br",null,null,-1)),p(" "+m(o.header.length<V.value?o.header:o.header.substr(0,V.value)+"...")+" ",1),l("span",ut,m(o.isIncludeOffers?o.offers.some(f=>f.bookingID===o.id)?"Tarjous lähetetty":"Tee tarjous":"Varmista tilaus"),1)],8,rt)],2),o?.disabled?(i(),c("div",dt,[l("p",vt,[p(m(`${o.user.firstName} on poistanut tilauksen!`),1),t[13]||(t[13]=l("strong",null,"Go",-1))])])):C("",!0),o.id===P.value?(i(),M(s(me),{key:1,id:"collapsibleContent1",ref_for:!0,ref:B,modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=f=>v.value=f)},{default:d(()=>[l("div",{ref_for:!0,ref_key:"collapseEl",ref:j,class:"card-body mt-3"},[u(ye,{open:A.value,onResizeParent:e.syncParentHeight,onUnlockParent:e.unlockParentHeight,"is-disabled":o?.disabled,client:k.value},null,8,["open","onResizeParent","onUnlockParent","is-disabled","client"])],512)]),_:2},1032,["modelValue"])):C("",!0)],2))]))),128))])):(i(),c("div",Ct,[u(s(ie),{stacking:!1,autohide:"",delay:3e3,modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=o=>y.value=o),position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:d(()=>[...t[17]||(t[17]=[p(" PROKEIKKATORI ",-1)])]),default:d(()=>[l("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:t[6]||(t[6]=(...o)=>e.hideError&&e.hideError(...o))}),p(" "+m(S.value),1)]),_:1},8,["modelValue"]),l("p",{style:{"text-align":"right",color:"forestgreen","padding-bottom":"50px"},onClick:te},"Poistu"),t[18]||(t[18]=l("h2",null,"Ei tarjouksia!",-1))]))])]),_:1}))}}),It=Oe(ht,[["__scopeId","data-v-cdae3b5b"]]);export{It as default};
