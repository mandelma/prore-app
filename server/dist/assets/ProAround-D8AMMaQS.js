import{_ as ae,C as ee,x as $,i as _,o as C,w,g as a,b as v,y as k,c as O,z as U,e as d,v as le,I as xe,m as J,h as L,J as Ce,r as s,N as Me,k as De,a as Le,O as te,D as qe,n as oe,Q as Se,A as R,E as Ie,L as Ve,M as Pe,P as Te,q as Oe,l as Ee,R as Ne,S as _e,t as $e,V as Fe,W as He,Y as ze}from"./index-4kmDbnUl.js";import{o as Ae,s as Be}from"./index-DmlHzmcU.js";import{l as Re}from"./loadGoogleMap-DZ-zVA3K.js";import"./index-93e-Jyro.js";const Ue=(I,h)=>{const c=new Date(I);return new Date(h)>=c},je=(I,h,c)=>{const f=new Date(I),g=new Date(h),y=new Date(c);return f>=g&&f<y},Ge={compare:Ue,providerMatchingForClient:je},Ke={style:{"background-color":"#0b1618",padding:"17px",border:"1px solid #1B2330","border-radius":"8px"}},We={class:"field-wrapper"},Je={class:"field-wrapper"},Ye={class:"field-wrapper"},Qe={key:0,class:"field-footer"},Xe={style:{"margin-top":"17px"},class:"field-wrapper"},Ze={key:0,class:"field-footer"},et={class:"message-counter"},tt=Object.assign({name:"request-form"},{__name:"RequestForm",props:{target:{type:null},date:String},emits:["sendRequest"],setup(I,{emit:h}){const c=I,f=h,g=ee({requestHeader:"",requestContent:""}),y=ee({}),D=()=>(y.requestHeader=g.requestHeader?"":"Header is required",y.requestContent=g.requestContent?"":"Kuvaus is required",!y.requestHeader&&!y.requestContent);$(()=>g.requestHeader,()=>y.requestHeader=""),$(()=>g.requestContent,()=>y.requestContent="");const V=r=>r instanceof Date&&!isNaN(+r),F=r=>{if(!r)return null;if(r instanceof Date)return V(r)?r:null;if(typeof r=="string"){const m=new Date(r.includes("T")?r:r.replace(",","").replace(" ","T"));if(V(m))return m;let x=r.match(/^(\d{4})-(\d{2})-(\d{2})[,\s]+(\d{2}):(\d{2})(?::(\d{2}))?$/);if(x){const[,q,p,S,M,P,E]=x.map(Number);return new Date(q,p-1,S,M,P,E||0)}if(x=r.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})(?::(\d{2}))?$/),x){const[,q,p,S,M,P,E]=x.map(Number);return new Date(S,p-1,q,M,P,E||0)}}return null},j=r=>{const m=F(r);return V(m)?new Intl.DateTimeFormat("fi-FI",{dateStyle:"long",timeStyle:"short",timeZone:"Europe/Helsinki",hour12:!1,hourCycle:"h23"}).format(m):""},H=()=>{D()?(console.log("Validated"),f("sendRequest",{header:g.requestHeader,content:g.requestContent})):console.log("No validated")};return(r,m)=>(C(),_(d(Ce),null,{default:w(()=>[a("form",Ke,[a("div",We,[a("p",null,k(c.target?.address),1)]),a("div",Je,[a("p",null,k(j(c.date)),1)]),a("div",Ye,[v(d(le),{label:"Syötä tilauksen avainsana *",modelValue:g.requestHeader,"onUpdate:modelValue":m[0]||(m[0]=x=>g.requestHeader=x),size:"lg",invalidFeedback:"Ole hyvä ja kirjoita avainsana.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),y.requestHeader?(C(),O("span",Qe,k(y.requestHeader),1)):U("",!0),a("div",Xe,[v(d(xe),{maxlength:"70",label:"Kuvaus tilauksen sisällöstä *",rows:"3",modelValue:g.requestContent,"onUpdate:modelValue":m[1]||(m[1]=x=>g.requestContent=x),invalidFeedback:"Ole hyvä ja kirjoita tehtävän kuvaus.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),y.requestContent?(C(),O("span",Ze,k(y.requestContent),1)):U("",!0),a("span",et,k(g.requestContent.length)+" / 70",1)])]),v(d(J),{color:"primary",onClick:H},{default:w(()=>[...m[2]||(m[2]=[L("Kinnita",-1)])]),_:1})])]),_:1}))}}),ot=ae(tt,[["__scopeId","data-v-de75f0dd"]]),at={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},lt={key:0,class:"client-map-panel"},nt={style:{display:"flex","justify-content":"right"}},st={class:"input-group"},it={class:"field-wrapper"},rt={key:0},dt={key:1},ut={class:"flex items-center gap-2"},ct={class:"distSelectPanel"},mt={class:"field-wrapper"},pt={style:{"margin-top":"15px"}},gt={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},vt={style:{padding:"13px 0 20px 0"}},ft=Object.assign({name:"pro-around"},{__name:"ProAround",setup(I){const h=s(null),c=s(null),f=s(null),g=s(!1),y=Ae,D=s(""),V=s(!1),F=s(!1),j=s(""),H=s(!1),r=s(null);s(0),s(!1);const m=s(!0),x=s(null),q=s(0),p=s(null),S=s(null),M=s(null),P=Ge,E=s(0),z=s(!1),A=s(!1),G=s(null),Y=s(!1),ne=s(""),se=Me(),Q=De(),ie=Le(),{user:re}=te(Q),{providerId:de}=te(ie),ue=s([{text:"0 km",value:1},{text:"1 km",value:1},{text:"10 km",value:10},{text:"20 km",value:20},{text:"30 km",value:30},{text:"40 km",value:40},{text:"50 km",value:50},{text:"60 km",value:60},{text:"70 km",value:70},{text:"80 km",value:80},{text:"90 km",value:90},{text:"100 km",value:100},{text:"200 km",value:200},{text:"300 km",value:300}]);$(F,t=>{t&&(console.log("Ready? "+t),$(r,e=>{console.log("Dist is changed ",e),we(D.value.label,e)},{immediate:!0}))}),$(z,t=>{if(t){p.value=me(new Date),q.value++;const o=new Date().toLocaleString("fi-FI",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",","");S.value=o}else p.value=null,S.value=null,q.value++});const ce=()=>{console.log("Changed "+D.value.label),j.value=D.value.label,H.value=!0};function me(t=new Date){const e=B=>String(B).padStart(2,"0"),l=t.getFullYear(),o=e(t.getMonth()+1),i=e(t.getDate()),u=e(t.getHours()),n=e(t.getMinutes());return`${l}-${o}-${i}, ${u}:${n}`}const pe=async()=>{try{await Re(),console.log("Map is inited in pro around! ✅"),ge();const t=document.getElementById("client-input"),e={lat:50.064192,lng:-130.605469},o={bounds:{north:e.lat+.1,south:e.lat-.1,east:e.lng+.1,west:e.lng-.1},componentRestrictions:{country:"fi"},fields:["address_components","geometry","icon","name","formatted_address"],strictBounds:!1},i=new google.maps.places.Autocomplete(t,o);i.addListener("place_changed",()=>{let u=i.getPlace();c.value=u.geometry.location.lat(),f.value=u.geometry.location.lng(),console.log("Address xxxx "+u.formatted_address),console.log("place-----lat------"+c.value)});try{new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(c.value,f.value),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50})}catch(u){console.log("Error to load map: "+u.message)}}catch(t){console.error("Google Maps failed to load ❌",t),g.value=!0}},ge=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{const{latitude:e,longitude:l}=t.coords;c.value=e,f.value=l,console.log("myLat "+e),ve(e,l)})},ve=(t,e)=>{try{console.log("Map is loading...");const l=document.getElementById("map");if(!l)throw new Error("Map container #map not found");if(!(l instanceof HTMLElement))throw new Error("Map container is not an HTMLElement");const o=new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50}),i=document.getElementById("spinner");google.maps.event.addListenerOnce(o,"tilesloaded",()=>{console.log("tiles loaded"),i.style.opacity="0",setTimeout(()=>i.style.display="none",400),F.value=!0})}catch(l){console.log("Error to load map: "+l.message)}fe(t,e)},fe=(t,e)=>{$e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&key=AIzaSyDt2YXE5tk0J72JgqnH3DTD7MeoqbbWBmU").then(l=>{l.data.error_message?console.log(l.data.error_message):(new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP}),h.value=l.data.results[1].formatted_address)}).catch(l=>{console.log(l.message)})},X=(t,e,l,o)=>{var i=new google.maps.LatLng(t,e),u=new google.maps.LatLng(l,o);return(google.maps.geometry.spherical.computeDistanceBetween(i,u)/1e3).toFixed(2)},ye=async(t,e,l)=>{if(!window.google||!window.google.maps){console.error("Google Maps not loaded yet");return}console.log("Profession and dist... "+e+" "+l),console.log("lat - "+c.value);let o=!1,i=new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(c.value,f.value),mapTypeId:google.maps.MapTypeId.ROADMAP});console.log("Users count: "+t.length),console.log("Current distance "+l),p.value&&(console.log("Booking date 2 "+new Date(p.value)),new Date(p.value));let u=0;if(t.length>0){for(let n=0;n<t.length;n++)console.log("-----Firma------- "+t[n].pName),c.value,f.value,t[n].profession.forEach(B=>{if(B===e&&(console.log("Pro "+B),t[n].latitude,t[n].longitude,console.log("Distance btw "+X(c.value,f.value,t[n].latitude,t[n].longitude)),X(c.value,f.value,t[n].latitude,t[n].longitude)<=l)){u++;let T;const W=Z(p.value);t[n].isAvailable24_7?T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].yritys,icon:this.pinSymbol("seagreen","darkgreen"),label:{color:"green",fontWeight:"bold",fontSize:"14px"}}):t[n].timetable.length>0?t[n].timetable.map(b=>{console.log("Date: "+W),console.log("Start: "+b.start),console.log("Fitting datetime: "+P.providerMatchingForClient(W,b.start,b.end)),P.providerMatchingForClient(W,b.start,b.end)||t[n].isAvailable24_7?T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("seagreen","darkgreen")}):T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("orange","darkorange")})}):T=new google.maps.Marker({position:new google.maps.LatLng(t[n].latitude,t[n].longitude),accuracy:50,map:i,title:t[n].pName,icon:K("orange","darkorange")}),window.myGlobalFunction=this&&this.openMarker?this.openMarker.bind(this):b=>ke(t[b]);const N=new google.maps.InfoWindow;N.addListener("domready",()=>{const b=document.querySelector(".gm-ui-hover-effect");b&&(b.style.display="none"),document.getElementById("custom-close")?.addEventListener("click",()=>N.close())}),T.addListener("click",()=>{console.log("POOOOS",n);const b=n;o&&o.close(),o=N,N.setContent(`
                <div class="custom-info">
                  <div style="display: flex; justify-content: right;">
                    <button id="custom-close">×</button>
                  </div>
                  
                  <h3>My Place</h3>
                  <p>Hello world!</p>
                  <div>
                  <p style="color: green;">${t[b].pName}</p>
                  <p style="color: red;" onclick="myGlobalFunction(${b})">Tiedot</p>
                </div>
                </div>
                `),N.open({anchor:T,map:i,shouldFocus:!1})})}});E.value=u,u>0?(console.log("Pro count existing..."),m.value=!1):console.log("Pro count not existing..."),x.value=u,console.log("countxx "+u)}},we=async(t,e)=>{console.log("Current distance herexx  ");const l=await ze.getProviders();l&&ye(l,t,e)},ke=t=>{console.log("Ordered company: "+t.pName),M.value=t,G.value=t,A.value=!0},Z=t=>{const e=t?.match(/^(\d{2})\/(\d{2})\/(\d{4}),?\s+(\d{2}):(\d{2})$/);if(!e)return null;const[,l,o,i,u,n]=e.map(Number);return new Date(i,o-1,l,u,n)},he=async t=>{const e=await Q.user.id,l=M.value.user.id;console.log("Sending request to "+M.value.user.username);const o=Z(p.value);let i;o?(i=o.getTime(),console.log("Milliseconds:",i)):console.log("Invalid date string");const u={author_id:e,created:o,created_ms:i,dateStr:p.value,header:t.header,agreement:!1,address:h.value,latitude:c.value,longitude:f.value,zone:0,professional:D.value.label,isIncludeOffers:!1,description:t.content,status:"pending"};A.value=!1,se.onRequest(l,e,M.value,re.value,u)};qe(async()=>{await pe()});const be=()=>{V.value=!1,h.value=""},K=(t,e)=>{const l=document.createElement("div");return l.className="price-tag",l.textContent="$2.5M",{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:t,fillOpacity:1,strokeColor:e,strokeWeight:2,scale:1,labelOrigin:{x:60,y:-25}}};return(t,e)=>{const l=Oe("HandleToast");return C(),O(_e,null,[a("div",null,[a("div",at,[m.value?(C(),O("div",lt,[a("div",nt,[v(d(oe),{size:"lg",style:{padding:"10px"},onClick:e[0]||(e[0]=o=>m.value=!1)},{default:w(()=>[...e[13]||(e[13]=[a("i",{class:"fas fa-expand-arrows-alt"},null,-1)])]),_:1}),a("div",null,[v(d(Se),{white:"",style:{padding:"10px"},size:"sm",onClick:e[1]||(e[1]=o=>t.$router.go(-1))})])]),a("div",{class:R([{hideClientInput:!h.value&&V.value},"field-wrapper"]),style:{width:"100%"}},[a("div",st,[v(d(le),{size:"sm",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),label:"Anna osoite",id:"client-input",placeholder:"",wrapperClass:"form-outline flex-grow-3",inputClass:"ps-0","aria-describedby":"button-addon2"},null,8,["modelValue"]),h.value?(C(),_(d(J),{key:0,type:"button",style:{border:"1px solid #ddd"}},{default:w(()=>[v(d(oe),{size:"1x",onClick:e[3]||(e[3]=o=>be())},{default:w(()=>[...e[14]||(e[14]=[a("i",{class:R("fas fa-times")},null,-1)])]),_:1})]),_:1})):U("",!0)])],2),a("div",it,[a("div",null,[v(d(Be),{style:Ie([{width:"100%"},t.isNoPro?"color: pink; border: 1px solid red;":"color: white;"]),modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=o=>D.value=o),onChange:ce,options:d(y),filter:"",optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Valitse ammattilainen *",class:"w-full md:w-[30rem]"},{value:w(o=>[o.value?(C(),O("div",rt,[a("div",null,k(o.value.label),1)])):(C(),O("span",dt,k(o.placeholder),1))]),optiongroup:w(o=>[a("div",ut,[a("i",{class:R(o.option.icon),style:{"font-size":"17px",color:"cadetblue"}},null,2),e[15]||(e[15]=L("    ",-1)),a("span",null,k(o.option.label),1)])]),_:1},8,["modelValue","options","style"])])]),a("div",{class:R({hideDistSelectPanel:!H.value})},[e[16]||(e[16]=a("p",{style:{"text-align":"left"}},"Valitse kiinnostavaa ajankohta tai heti!",-1)),a("div",ct,[a("div",mt,[(C(),_(d(Ve),{size:"lg",label:"Valitse tehtävän päivämäärä ja aika",modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),toggleButton:!1,inputToggle:"",datepicker:{...t.L},timepicker:{...t.L,hoursFormat:24},key:q.value,disablePast:""},null,8,["modelValue","datepicker","timepicker"]))]),L(" isDateNow "+k(z.value)+" date "+k(S.value)+" ",1),a("div",pt,[v(d(Pe),{label:"Heti!",name:"selection",modelValue:z.value,"onUpdate:modelValue":e[6]||(e[6]=o=>z.value=o),value:"true",onClick:t.removeDateIfExist,wrapperClass:"mb-4"},null,8,["modelValue","onClick"])]),L(" dt "+k(p.value),1)])],2),v(d(Te),{size:"sm",white:"",selected:r.value,"onUpdate:selected":e[7]||(e[7]=o=>r.value=o),options:ue.value,label:"Etsi alue",id:"distance"},null,8,["selected","options"])])):(C(),_(d(J),{key:1,color:"primary",style:{position:"absolute",opacity:"0.8",top:"60px",left:"80%","z-index":"2"},onClick:e[8]||(e[8]=o=>m.value=!0)},{default:w(()=>[...e[17]||(e[17]=[L(" Paneeli ",-1)])]),_:1}))]),e[20]||(e[20]=L(" /* ",-1)),a("div",gt,[v(l,{modelValue:t.toastModel,"onUpdate:modelValue":e[9]||(e[9]=o=>t.toastModel=o),"toast-name":t.toastState,"icon-state":t.toastIcon,text:t.toastContent},null,8,["modelValue","toast-name","icon-state","text"])]),e[21]||(e[21]=L(" */ ",-1)),a("div",vt,[v(d(Ee),{modelValue:Y.value,"onUpdate:modelValue":e[11]||(e[11]=o=>Y.value=o),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:w(()=>[...e[18]||(e[18]=[L("PROKEIKKATORI",-1)])]),small:w(()=>[...e[19]||(e[19]=[])]),default:w(()=>[a("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[10]||(e[10]=(...o)=>t.hideError&&t.hideError(...o))}),a("p",null,k(ne.value),1)]),_:1},8,["modelValue"])]),a("div",null,[v(d(Ne),{tabindex:"-1",centered:"",modelValue:A.value,"onUpdate:modelValue":e[12]||(e[12]=o=>A.value=o)},{default:w(()=>[v(d(Fe),null,{default:w(()=>[a("h2",null,k(G.value.pName),1)]),_:1}),v(d(He),null,{default:w(()=>[a("p",null,"Tällä - "+k(G.value.pName)+" - tiedot...",1),M.value.id!==d(de)?(C(),_(ot,{key:0,target:M.value,date:p.value,onSendRequest:he},null,8,["target","date"])):U("",!0)]),_:1})]),_:1},8,["modelValue"])])]),e[22]||(e[22]=a("div",{id:"map-container"},[a("div",{id:"map"}),a("div",{id:"spinner",class:"spinner-overlay"},[a("div",{class:"spinner"})])],-1))],64)}}}),bt=ae(ft,[["__scopeId","data-v-e8451174"]]);export{bt as default};
