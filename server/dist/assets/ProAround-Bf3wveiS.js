import{C as ae,t as A,i as E,o as p,w as f,g as a,b as y,e as r,m as O,x as C,c as k,y as F,v as se,I as Ie,h as V,J as ie,q as re,N as de,O as $e,z as P,r as s,P as Ve,k as Ee,a as Te,Q as le,D as Be,n as ne,R as Pe,E as Ae,L as ze,M as He,S as Oe,l as Fe,V as Re,s as Ne,W as je,Y as Ue,_ as Ge,$ as We}from"./index-DW7v6QT8.js";import{o as Ke,s as Je}from"./index-xtpbSwDa.js";import{l as Ye}from"./loadGoogleMap-DZ-zVA3K.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-93e-Jyro.js";const Qe=(h,m)=>{const d=new Date(h);return new Date(m)>=d},Xe=(h,m,d)=>{const c=new Date(h),g=new Date(m),v=new Date(d);return c>=g&&c<v},Ze={compare:Qe,providerMatchingForClient:Xe},et={style:{"background-color":"#0b1618",padding:"17px",border:"1px solid #1B2330","border-radius":"8px"}},tt={style:{display:"flex","justify-content":"right"}},ot={class:"field-wrapper"},at={class:"field-wrapper"},lt={class:"field-wrapper"},nt={key:0,class:"field-footer"},st={style:{"margin-top":"17px"},class:"field-wrapper"},it={key:0,class:"field-footer"},rt={class:"message-counter"},dt=Object.assign({name:"request-form"},{__name:"RequestForm",props:{target:{type:null},date:String},emits:["sendRequest"],setup(h,{emit:m}){const d=h,c=m,g=ae({requestHeader:"",requestContent:""}),v=ae({}),b=()=>(v.requestHeader=g.requestHeader?"":"Avainsana on pakollinen kentä!",v.requestContent=g.requestContent?"":"Tilauksen lyhyt kuvaus on pakollinen!",!v.requestHeader&&!v.requestContent);A(()=>g.requestHeader,()=>v.requestHeader=""),A(()=>g.requestContent,()=>v.requestContent="");const M=()=>{b()?(console.log("Validated"),c("sendRequest",{header:g.requestHeader,content:g.requestContent})):console.log("No validated")};return(T,x)=>(p(),E(r(ie),null,{default:f(()=>[a("form",et,[a("div",tt,[y(r(O),{color:"dark"},{default:f(()=>[...x[2]||(x[2]=[a("i",{class:"far fa-comment"},null,-1)])]),_:1})]),a("div",ot,[a("p",null,C(d.target?.profession.join(", ")),1)]),a("div",at,[a("p",null,C(d.date),1)]),a("div",lt,[y(r(se),{label:"Syötä tilauksen avainsana *",modelValue:g.requestHeader,"onUpdate:modelValue":x[0]||(x[0]=_=>g.requestHeader=_),size:"lg",invalidFeedback:"Ole hyvä ja kirjoita avainsana.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),v.requestHeader?(p(),k("span",nt,C(v.requestHeader),1)):F("",!0),a("div",st,[y(r(Ie),{maxlength:"70",label:"Kuvaus tilauksen sisällöstä *",rows:"3",modelValue:g.requestContent,"onUpdate:modelValue":x[1]||(x[1]=_=>g.requestContent=_),invalidFeedback:"Ole hyvä ja kirjoita tehtävän kuvaus.",validFeedback:"Ok!",required:""},null,8,["modelValue"]),v.requestContent?(p(),k("span",it,C(v.requestContent),1)):F("",!0),a("span",rt,C(g.requestContent.length)+" / 70",1)])]),y(r(O),{color:"primary",onClick:M},{default:f(()=>[...x[3]||(x[3]=[V("LÄHETÄÄ TILAUS",-1)])]),_:1})])]),_:1}))}}),ut=J(dt,[["__scopeId","data-v-be922b21"]]),ct={name:"RatingStars",props:{rating:Number},components:{MDBContainer:ie},data(){return{}},computed:{stars(){let h=[],m=Math.floor(this.rating),d=this.rating%1>=.1;for(let c=0;c<m;c++)h.push("full");for(d&&h.push("half");h.length<5;)h.push("empty");return h}}},pt={key:0,class:"full-star"},mt={key:1,class:"half-star"},gt={key:2,class:"star"};function vt(h,m,d,c,g,v){const b=re("MDBContainer");return p(),E(b,null,{default:f(()=>[a("div",null,[(p(!0),k(de,null,$e(v.stars,(M,T)=>(p(),k("span",{key:T,class:P(["starGap",["star",{full:M==="full",half:M==="half"}]])},[M==="full"?(p(),k("span",pt,"★")):M==="half"?(p(),k("span",mt,"★")):(p(),k("span",gt,"★"))],2))),128))])]),_:1})}const ft=J(ct,[["render",vt],["__scopeId","data-v-4608ba88"]]),yt={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},ht={key:0,class:"client-map-panel"},wt={style:{display:"flex","justify-content":"right"}},kt={class:"input-group"},bt={class:"field-wrapper"},xt={key:0},Ct={key:1},Mt={class:"flex items-center gap-2"},Lt={class:"distSelectPanel"},St={class:"field-wrapper"},_t={style:{"margin-top":"15px"}},qt={style:{position:"relative","z-index":"1",opacity:"0.8","border-radius":"10px"}},Dt={style:{padding:"13px 0 20px 0"}},It={style:{display:"flex","justify-content":"space-between","align-items":"center",gap:"23px"}},$t=Object.assign({name:"pro-around"},{__name:"ProAround",setup(h){const m=s(null),d=s(null),c=s(null),g=s(!1),v=Ke,b=s(""),M=s(!1),T=s(!1),x=s(""),_=s(!1),R=s(null);s(0),s(!1);const z=s(!0),ue=s(null),N=s(0),w=s(null),Y=s(null),q=s(null),j=Ze,ce=s(0),U=s(!1),H=s(!1),Q=s(null),X=s(!1),pe=s(""),me=Ve(),Z=Ee(),ge=Te(),{user:ve}=le(Z),{providerId:fe}=le(ge),ye=s([{text:"0 km",value:1},{text:"1 km",value:1},{text:"10 km",value:10},{text:"20 km",value:20},{text:"30 km",value:30},{text:"40 km",value:40},{text:"50 km",value:50},{text:"60 km",value:60},{text:"70 km",value:70},{text:"80 km",value:80},{text:"90 km",value:90},{text:"100 km",value:100},{text:"200 km",value:200},{text:"300 km",value:300}]);A(T,t=>{t&&(console.log("Ready? "+t),A(R,e=>{console.log("Dist is changed ",e),Le(b.value.label,e)},{immediate:!0}))}),A(U,t=>{if(t){w.value=we(new Date),N.value++;const o=new Date().toLocaleString("fi-FI",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",","");Y.value=o}else w.value=null,Y.value=null,N.value++});const he=()=>{console.log("Changed "+b.value.label),x.value=b.value.label,_.value=!0};function we(t=new Date){const e=L=>String(L).padStart(2,"0"),n=t.getFullYear(),o=e(t.getMonth()+1),i=e(t.getDate()),l=e(t.getHours()),D=e(t.getMinutes());return`${n}-${o}-${i}, ${l}:${D}`}const ke=async()=>{try{await Ye(),console.log("Map is inited in pro around! ✅"),be();const t=document.getElementById("client-input"),e={lat:50.064192,lng:-130.605469},o={bounds:{north:e.lat+.1,south:e.lat-.1,east:e.lng+.1,west:e.lng-.1},componentRestrictions:{country:"fi"},fields:["address_components","geometry","icon","name","formatted_address"],strictBounds:!1},i=new google.maps.places.Autocomplete(t,o);i.addListener("place_changed",()=>{let l=i.getPlace();d.value=l.geometry.location.lat(),c.value=l.geometry.location.lng(),console.log("Address xxxx "+l.formatted_address),console.log("place-----lat------"+d.value)});try{new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(d.value,c.value),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50})}catch(l){console.log("Error to load map: "+l.message)}}catch(t){console.error("Google Maps failed to load ❌",t),g.value=!0}},be=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{const{latitude:e,longitude:n}=t.coords;d.value=e,c.value=n,console.log("myLat "+e),xe(e,n)})},xe=(t,e)=>{try{console.log("Map is loading...");const n=document.getElementById("map");if(!n)throw new Error("Map container #map not found");if(!(n instanceof HTMLElement))throw new Error("Map container is not an HTMLElement");const o=new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP,accuracy:50}),i=document.getElementById("spinner");google.maps.event.addListenerOnce(o,"tilesloaded",()=>{console.log("tiles loaded"),i.style.opacity="0",setTimeout(()=>i.style.display="none",400),T.value=!0})}catch(n){console.log("Error to load map: "+n.message)}Ce(t,e)},Ce=(t,e)=>{Ne.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&key=AIzaSyDt2YXE5tk0J72JgqnH3DTD7MeoqbbWBmU").then(n=>{n.data.error_message?console.log(n.data.error_message):(new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(t,e),mapTypeId:google.maps.MapTypeId.ROADMAP}),m.value=n.data.results[1].formatted_address)}).catch(n=>{console.log(n.message)})},ee=(t,e,n,o)=>{var i=new google.maps.LatLng(t,e),l=new google.maps.LatLng(n,o);return(google.maps.geometry.spherical.computeDistanceBetween(i,l)/1e3).toFixed(2)},Me=async(t,e,n)=>{if(!window.google||!window.google.maps){console.error("Google Maps not loaded yet");return}console.log("Profession and dist... "+e+" "+n),console.log("lat - "+d.value);let o=new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(d.value,c.value),mapTypeId:google.maps.MapTypeId.ROADMAP});console.log("Users count: "+t.length),console.log("Current distance "+n),w.value&&(console.log("Booking date 2 "+new Date(w.value)),new Date(w.value));let i=0;if(t.length>0){for(let l=0;l<t.length;l++)console.log("-----Firma------- "+t[l].pName),d.value,c.value,t[l].profession.forEach(D=>{if(D===e&&(console.log("Pro "+D),t[l].latitude,t[l].longitude,console.log("Distance btw "+ee(d.value,c.value,t[l].latitude,t[l].longitude)),ee(d.value,c.value,t[l].latitude,t[l].longitude)<=n)){i++;let L;const B=te(w.value);console.log("Cliend date format: ",B);let W=!1;t[l].isAvailable24_7?L=new google.maps.Marker({position:new google.maps.LatLng(t[l].latitude,t[l].longitude),accuracy:50,map:o,title:t[l].yritys,icon:this.pinSymbol("seagreen","darkgreen"),label:{color:"green",fontWeight:"bold",fontSize:"14px"}}):t[l].timetable.length>0?t[l].timetable.map(u=>{console.log("Date: "+B),console.log("Start: "+u.start),console.log("Fitting datetime: "+j.providerMatchingForClient(B,u.start,u.end)),W=j.providerMatchingForClient(B,u.start,u.end)?"Saatavilla":"Sovitaessa",console.log("Matching - ",W),j.providerMatchingForClient(B,u.start,u.end)||t[l].isAvailable24_7?L=new google.maps.Marker({position:new google.maps.LatLng(t[l].latitude,t[l].longitude),accuracy:50,map:o,title:t[l].pName,icon:G("seagreen","darkgreen")}):L=new google.maps.Marker({position:new google.maps.LatLng(t[l].latitude,t[l].longitude),accuracy:50,map:o,title:t[l].pName,icon:G("orange","darkorange")})}):L=new google.maps.Marker({position:new google.maps.LatLng(t[l].latitude,t[l].longitude),accuracy:50,map:o,title:t[l].pName,icon:G("orange","darkorange")}),window.myGlobalFunction=this&&this.openMarker?this.openMarker.bind(this):u=>Se(t[u]);const I=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(0,-10)});let K=null,S=null;I.addListener("domready",()=>{const u=document.getElementById("stars-mount");S&&(S.unmount(),S=null),u&&(S=We(ft,{rating:4}),S.mount(u)),document.getElementById("custom-close")?.addEventListener("click",()=>{S?.unmount(),S=null,I.close()},{once:!0});const oe=document.querySelector(".gm-ui-hover-effect");oe&&(oe.style.display="none");const $=document.getElementById("custom-iw"),De=document.getElementById("custom-close");$&&($.classList.remove("iw-close"),$.offsetWidth,$.classList.add("iw-open"),De?.addEventListener("click",()=>{$.classList.remove("iw-open"),$.classList.add("iw-close"),setTimeout(()=>I.close(),190)},{once:!0}))}),L.addListener("click",()=>{const u=l;K&&K.close(),K=I,I.setContent(`
                <div class="custom-info-window" id="custom-iw">
                  <button id="custom-close" class="close-btn" aria-label="Close">×</button>

                  <div class="header">
                    <div id="stars-mount"></div>
                  </div>

                  <table class="info-table" role="presentation">
                    <tr>
                      <td>
                        <img
                          src="https://mdbootstrap.com/img/Photos/Avatars/img (31).jpg"
                          class="rounded-circle"
                          height="33"
                          alt=""
                          loading="lazy"
                        />
                      </td>
                      <td>
                        ${t[u].description}
                      </td>
                    </tr>
                    <tr>
                      <th>${W}</th>
                      <td>${w.value}</td>
                    </tr>

                      <th>${t[u].profession.join(", ")}</th>
                      <td class="provider">${t[u].pName}</td>
                    </tr>
                    <tr>
                      <th>Tiedot</th>
                      <td><span class="info-link">Kotisivu</span></td>
                    </tr>
                    <tr>
                      <th>${t[u].priceByHour?"Tuntihinta":""}</th>
                      <td>${t[u].priceByHour?t[u].priceByHour+" eur":""}</td>
                    </tr>
                  </table>

                  <button class="bottom-btn" onclick="myGlobalFunction(${u})">
                    TEE TILAUS
                  </button>
                </div>
              `),I.open({map:o,anchor:L,shouldFocus:!1}),window.innerWidth<=480&&(o.panTo(L.getPosition()),o.panBy(0,-140))})}});ce.value=i,i>0?(console.log("Pro count existing..."),z.value=!1):console.log("Pro count not existing..."),ue.value=i,console.log("countxx "+i)}},Le=async(t,e)=>{console.log("Current distance herexx  ");const n=await Ge.getProviders();n&&Me(n,t,e)},Se=t=>{console.log("Ordered company: "+t.pName),q.value=t,Q.value=t,H.value=!0},te=t=>{const e=t?.match(/^(\d{2})\/(\d{2})\/(\d{4}),?\s+(\d{2}):(\d{2})$/);if(!e)return null;const[,n,o,i,l,D]=e.map(Number);return new Date(i,o-1,n,l,D)},_e=async t=>{const e=await Z.user.id,n=q.value.user.id;console.log("Sending request to "+q.value.user.username);const o=te(w.value);let i;o?(i=o.getTime(),console.log("Milliseconds:",i)):console.log("Invalid date string");const l={author_id:e,created:o,created_ms:i,dateStr:w.value,header:t.header,agreement:!1,address:m.value,latitude:d.value,longitude:c.value,zone:0,professional:b.value.label,isIncludeOffers:!1,description:t.content,status:"pending"};H.value=!1,me.onRequest(n,e,q.value,ve.value,l)};Be(async()=>{await ke()});const qe=()=>{M.value=!1,m.value=""},G=(t,e)=>{const n=document.createElement("div");return n.className="price-tag",n.textContent="$2.5M",{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:t,fillOpacity:1,strokeColor:e,strokeWeight:2,scale:1,labelOrigin:{x:60,y:-25}}};return(t,e)=>{const n=re("HandleToast");return p(),k(de,null,[a("div",null,[a("div",yt,[z.value?(p(),k("div",ht,[a("div",wt,[y(r(ne),{size:"lg",style:{padding:"10px"},onClick:e[0]||(e[0]=o=>z.value=!1)},{default:f(()=>[...e[13]||(e[13]=[a("i",{class:"fas fa-expand-arrows-alt"},null,-1)])]),_:1}),a("div",null,[y(r(Pe),{white:"",style:{padding:"10px"},size:"sm",onClick:e[1]||(e[1]=o=>t.$router.go(-1))})])]),a("div",{class:P([{hideClientInput:!m.value&&M.value},"field-wrapper"]),style:{width:"100%"}},[a("div",kt,[y(r(se),{size:"sm",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),label:"Anna osoite",id:"client-input",placeholder:"",wrapperClass:"form-outline flex-grow-3",inputClass:"ps-0","aria-describedby":"button-addon2"},null,8,["modelValue"]),m.value?(p(),E(r(O),{key:0,type:"button",style:{border:"1px solid #ddd"}},{default:f(()=>[y(r(ne),{size:"1x",onClick:e[3]||(e[3]=o=>qe())},{default:f(()=>[...e[14]||(e[14]=[a("i",{class:P("fas fa-times")},null,-1)])]),_:1})]),_:1})):F("",!0)])],2),a("div",bt,[a("div",null,[y(r(Je),{style:Ae([{width:"100%"},t.isNoPro?"color: pink; border: 1px solid red;":"color: white;"]),modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),onChange:he,options:r(v),filter:"",optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Valitse ammattilainen *",class:"w-full md:w-[30rem]"},{value:f(o=>[o.value?(p(),k("div",xt,[a("div",null,C(o.value.label),1)])):(p(),k("span",Ct,C(o.placeholder),1))]),optiongroup:f(o=>[a("div",Mt,[a("i",{class:P(o.option.icon),style:{"font-size":"17px",color:"cadetblue"}},null,2),e[15]||(e[15]=V("    ",-1)),a("span",null,C(o.option.label),1)])]),_:1},8,["modelValue","options","style"])])]),a("div",{class:P({hideDistSelectPanel:!_.value})},[e[16]||(e[16]=a("p",{style:{"text-align":"left"}},"Valitse kiinnostavaa ajankohta tai heti!",-1)),a("div",Lt,[a("div",St,[(p(),E(r(ze),{size:"lg",label:"Valitse tehtävän päivämäärä ja aika",modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value=o),toggleButton:!1,inputToggle:"",datepicker:{...t.L},timepicker:{...t.L,hoursFormat:24},key:N.value,disablePast:""},null,8,["modelValue","datepicker","timepicker"]))]),a("div",_t,[y(r(He),{label:"Heti!",name:"selection",modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=o=>U.value=o),value:"true",onClick:t.removeDateIfExist,wrapperClass:"mb-4"},null,8,["modelValue","onClick"])])])],2),y(r(Oe),{size:"sm",selected:R.value,"onUpdate:selected":e[7]||(e[7]=o=>R.value=o),options:ye.value,label:"Etsi alue",id:"distance"},null,8,["selected","options"])])):(p(),E(r(O),{key:1,color:"primary",style:{position:"absolute",opacity:"0.8",top:"60px",left:"80%","z-index":"2"},onClick:e[8]||(e[8]=o=>z.value=!0)},{default:f(()=>[...e[17]||(e[17]=[V(" Paneeli ",-1)])]),_:1}))]),e[21]||(e[21]=V(" /* ",-1)),a("div",qt,[y(n,{modelValue:t.toastModel,"onUpdate:modelValue":e[9]||(e[9]=o=>t.toastModel=o),"toast-name":t.toastState,"icon-state":t.toastIcon,text:t.toastContent},null,8,["modelValue","toast-name","icon-state","text"])]),e[22]||(e[22]=V(" */ ",-1)),a("div",Dt,[y(r(Fe),{modelValue:X.value,"onUpdate:modelValue":e[11]||(e[11]=o=>X.value=o),autohide:"",delay:3e3,stacking:!1,position:"top-center",toast:"success",icon:"fas fa-check fa-lg me-2"},{title:f(()=>[...e[18]||(e[18]=[V("PROKEIKKATORI",-1)])]),small:f(()=>[...e[19]||(e[19]=[])]),default:f(()=>[a("button",{type:"button",style:{visibility:"hidden"},class:"btn-close ms-auto","aria-label":"Close",onClick:e[10]||(e[10]=(...o)=>t.hideError&&t.hideError(...o))}),a("p",null,C(pe.value),1)]),_:1},8,["modelValue"])]),a("div",null,[y(r(Re),{tabindex:"-1",centered:"",modelValue:H.value,"onUpdate:modelValue":e[12]||(e[12]=o=>H.value=o)},{default:f(()=>[y(r(je),null,{default:f(()=>[a("div",It,[e[20]||(e[20]=a("img",{src:"https://mdbootstrap.com/img/Photos/Avatars/img (31).jpg",class:"rounded-circle",height:"53",alt:"",loading:"lazy"},null,-1)),a("h2",null,C(Q.value.pName),1)])]),_:1}),y(r(Ue),null,{default:f(()=>[q.value.id!==r(fe)?(p(),E(ut,{key:0,target:q.value,date:w.value,onSendRequest:_e},null,8,["target","date"])):F("",!0)]),_:1})]),_:1},8,["modelValue"])])]),e[23]||(e[23]=a("div",{id:"map-container"},[a("div",{id:"map"}),a("div",{id:"spinner",class:"spinner-overlay"},[a("div",{class:"spinner"})])],-1))],64)}}}),At=J($t,[["__scopeId","data-v-d23deed6"]]);export{At as default};
